<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>রামগঞ্জ সরকারি কলেজ - দৈনিক পাঠদান সূচি (2025-26)</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Bengali:wght@400;700;900&display=swap');
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap'); /* Added Inter for numbers/times */

    :root {
      /* Dark Mode Defaults */
      --bg-start: #ee7752;
      --bg-mid1: #e73c7e;
      --bg-mid2: #23a6d5;
      --bg-end: #23d5ab;
      --glass-bg: rgba(255, 255, 255, 0.08);
      --glass-border: rgba(255, 255, 255, 0.2);
      --glass-shadow: rgba(0, 0, 0, 0.15);
      --text-light: #fff;
      --text-dark: #333;
      --accent-gold: #ffd700;
      --current-day-bg: rgba(255, 0, 150, 0.25);
      --current-class-bg: linear-gradient(135deg, rgba(255, 107, 107, 0.9), rgba(255, 217, 61, 0.9));
      --widget-bg: linear-gradient(135deg, rgba(255, 99, 71, 0.8), rgba(255, 69, 0, 0.8));
      --widget-border-glow: linear-gradient(45deg, #ff4500, #ff6347, #ffa500, #ff4500);
      --countdown-bg: rgba(255, 255, 255, 0.15);
      --countdown-border: rgba(255, 255, 255, 0.3);
      --countdown-text: #fff;
      --countdown-glow: rgba(0, 255, 255, 0.4);
      --modal-bg: rgba(255, 255, 255, 0.15);
      --modal-border: rgba(255, 255, 255, 0.3);
      --modal-shadow: rgba(0, 0, 0, 0.3);
      --modal-close-btn: rgba(255, 255, 255, 0.7);
      --input-bg: rgba(0, 0, 0, 0.2);
      --input-border: var(--glass-border);
      --input-color: var(--text-light);
      --input-placeholder: rgba(255, 255, 255, 0.6);
      --response-area-bg: rgba(0, 0, 0, 0.25);
      --response-area-border: rgba(255, 255, 255, 0.2);
      --button-text: white;
      --message-box-bg: linear-gradient(135deg, #4CAF50, #8BC34A); /* Green gradient for success */
      --message-box-border: #4CAF50;
      --message-box-shadow: rgba(76, 175, 80, 0.4);
      --message-box-text: white;
      --copy-button-bg: linear-gradient(45deg, #FFD700, #FFA500);
      --copy-button-hover-bg: linear-gradient(45deg, #FFA500, #FFD700);
      --copy-button-shadow: rgba(255, 215, 0, 0.4);
    }

    body.light-mode {
      --bg-start: #89f7fe;
      --bg-mid1: #66a6ff;
      --bg-mid2: #a1c4fd;
      --bg-end: #c2e9fb;
      --glass-bg: rgba(255, 255, 255, 0.6);
      --glass-border: rgba(0, 0, 0, 0.1);
      --glass-shadow: rgba(0, 0, 0, 0.1);
      --text-light: #333;
      --text-dark: #eee;
      --accent-gold: #da9100;
      --current-day-bg: rgba(255, 192, 203, 0.5); /* Light pink */
      --current-class-bg: linear-gradient(135deg, rgba(255, 160, 122, 0.8), rgba(255, 223, 186, 0.8)); /* Lighter gradient */
      --widget-bg: linear-gradient(135deg, rgba(255, 140, 0, 0.8), rgba(255, 165, 0, 0.8));
      --widget-border-glow: linear-gradient(45deg, #ff8c00, #ffa500, #ffd700, #ff8c00);
      --countdown-bg: rgba(0, 0, 0, 0.1);
      --countdown-border: rgba(0, 0, 0, 0.2);
      --countdown-text: #333;
      --countdown-glow: rgba(0, 191, 255, 0.4);
      --modal-bg: rgba(255, 255, 255, 0.9);
      --modal-border: rgba(0, 0, 0, 0.15);
      --modal-shadow: rgba(0, 0, 0, 0.2);
      --modal-close-btn: rgba(51, 51, 51, 0.7);
      --input-bg: rgba(255, 255, 255, 0.8);
      --input-border: rgba(0, 0, 0, 0.2);
      --input-color: var(--text-light);
      --input-placeholder: rgba(51, 51, 51, 0.6);
      --response-area-bg: rgba(255, 255, 255, 0.7);
      --response-area-border: rgba(0, 0, 0, 0.1);
      --button-text: white; /* Buttons remain white text for contrast */
      --message-box-bg: linear-gradient(135deg, #4CAF50, #8BC34A);
      --message-box-border: #4CAF50;
      --message-box-shadow: rgba(76, 175, 80, 0.4);
      --message-box-text: white;
      --copy-button-bg: linear-gradient(45deg, #FFD700, #FFA500);
      --copy-button-hover-bg: linear-gradient(45deg, #FFA500, #FFD700);
      --copy-button-shadow: rgba(255, 215, 0, 0.4);
    }
    
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body { 
      font-family: 'Noto Sans Bengali', 'Inter', sans-serif; /* বাংলা লেখার জন্য Noto Sans Bengali, সংখ্যা ও সময়ের জন্য Inter */
      min-height: 100vh;
      background: linear-gradient(-45deg, var(--bg-start), var(--bg-mid1), var(--bg-mid2), var(--bg-end));
      background-size: 400% 400%;
      animation: gradient-bg 40s ease infinite; /* আরও ধীর অ্যানিমেশন */
      display: flex; 
      flex-direction: column; 
      justify-content: center; 
      align-items: center;
      padding: 20px;
      overflow-y: auto; /* Allow vertical scrolling for the body */
      overflow-x: auto; /* Allow horizontal scrolling for the body */
      color: var(--text-light); 
      transition: background-color 0.5s ease; /* Smooth transition for theme change */
    }
    
    @keyframes gradient-bg {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    
    /* ভাসমান কণা */
    .particles {
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      pointer-events: none; /* কণাগুলিতে ক্লিক করা যাবে না */
      z-index: 1;
      overflow: hidden; 
    }
    
    .particle {
      position: absolute;
      background: radial-gradient(circle, rgba(255,255,255,0.5) 0%, transparent 70%); /* আরও কম অস্বচ্ছ */
      border-radius: 50%;
      opacity: 0; 
      animation: float 20s ease-in-out infinite, fadeInParticle 2s forwards; /* আরও ধীর, সরল ভাসমান অ্যানিমেশন */
      transition: transform 0.3s ease-out, opacity 0.3s ease-out, width 0.3s ease-out, height 0.3s ease-out; /* ইন্টারেক্টিভ অ্যানিমেশনের জন্য ট্রানজিশন */
    }

    @keyframes fadeInParticle {
      to { opacity: 1; }
    }
    
    /* অপ্টিমাইজড ভাসমান অ্যানিমেশন */
    @keyframes float {
      0%, 100% { transform: translateY(0px); opacity: 0.5; } 
      50% { transform: translateY(-20px); opacity: 0.2; } /* শুধুমাত্র translateY, আরও কম অস্বচ্ছতা */
    }

    /* ইন্টারেক্টিভ কণার স্টাইল */
    .particle.attracted {
        opacity: 0.8 !important;
        transform: translate(-50%, -50%) scale(1.5) !important; /* সেন্টারে এনে বড় করা */
        background: radial-gradient(circle, rgba(255,255,255,0.9) 0%, transparent 70%) !important;
    }
    
    .container { 
      width: 100%; 
      max-width: 1500px; 
      position: relative; 
      z-index: 2;
      display: flex;
      flex-direction: column;
      gap: 20px; 
    }

    /* ডায়নামিক ক্লাস উইজেট (বর্তমান/আসন্ন ক্লাস দেখানোর জন্য) */
    #dynamic-class-widget {
      background: var(--widget-bg); 
      background-size: 300% 300%;
      backdrop-filter: blur(15px); 
      -webkit-backdrop-filter: blur(15px);
      border: 1px solid var(--glass-border);
      border-radius: 20px;
      padding: 25px;
      text-align: center;
      box-shadow: 0 4px 18px rgba(0, 0, 0, 0.25), inset 0 1px 0 rgba(255, 255, 255, 0.2); 
      animation: fadeIn 1s ease-out, widget-gradient 8s ease infinite; 
      position: relative;
      overflow: hidden;
      margin-bottom: 20px; 
      color: var(--text-light); /* Ensure text color changes with theme */
    }

    #dynamic-class-widget::before {
      content: '';
      position: absolute;
      top: -2px; left: -2px; right: -2px; bottom: -2px;
      background: var(--widget-border-glow); 
      background-size: 400%;
      border-radius: 22px;
      z-index: -1;
      animation: border-glow 18s linear infinite; 
      filter: blur(1px); 
    }

    @keyframes widget-gradient {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
    }

    #dynamic-class-widget h2 {
      font-size: 28px;
      font-weight: 900;
      margin-bottom: 15px;
      color: var(--text-light); /* Ensure text color changes with theme */
      text-shadow: 0 0 8px rgba(255, 255, 255, 0.4); 
      background: linear-gradient(45deg, #ff8c00, #ff4500); 
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: text-glow 5s ease-in-out infinite alternate; 
    }

    #dynamic-class-widget p {
      font-size: 20px;
      margin-bottom: 5px; 
      color: var(--text-light); /* Ensure text color changes with theme */
      line-height: 1.5;
    }

    #dynamic-class-widget .teacher-name-bangla {
        font-weight: bold;
        font-size: 22px;
        margin-bottom: 2px;
    }

    #dynamic-class-widget .teacher-name-english {
        font-family: 'Inter', sans-serif;
        font-size: 16px;
        color: var(--text-light); /* Ensure text color changes with theme */
        margin-bottom: 15px; 
    }

    #dynamic-class-widget .no-class {
      font-style: italic;
      opacity: 0.8;
    }

    /* নতুন জুম কন্ট্রোল স্টাইল (বাটনগুলো সরানো হয়েছে) */
    .zoom-controls {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 10px;
        margin-bottom: 20px;
        padding: 10px 15px;
        background: var(--glass-bg); /* Use glass-bg for consistency */
        border-radius: 15px;
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
        border: 1px solid var(--glass-border);
        box-shadow: 0 2px 10px var(--glass-shadow);
    }

    .zoom-level {
        font-family: 'Inter', sans-serif;
        font-size: 18px;
        color: var(--text-light);
        font-weight: bold;
        min-width: 60px;
        text-align: center;
    }
    
    /* রুটিন টেবিলের জন্য স্ক্রলযোগ্য র্যাপার */
    .routine-scroll-wrapper {
        width: 100%;
        overflow: auto; /* টেবিল জুম হলে স্ক্রল করার অনুমতি দেয় */
        border-radius: 24px; /* টেবিলের বর্ডার-রেডিয়াসের সাথে মিলিয়ে */
        position: relative;
        z-index: 2; /* কণাগুলির উপরে রাখে */
        box-shadow: 0 4px 18px var(--glass-shadow); /* টেবিলের শ্যাডো সাথে মিলিয়ে */
        background: var(--glass-bg); /* টেবিলের ব্যাকগ্রাউন্ড সাথে মিলিয়ে */
        backdrop-filter: blur(12px); /* টেবিলের ব্যাকড্রপ-ফিল্টার সাথে মিলিয়ে */
        -webkit-backdrop-filter: blur(12px); /* টেবিলের ব্যাকড্রপ-ফিল্টার সাথে মিলিয়ে */
        border: 1px solid var(--glass-border); /* টেবিলের বর্ডার সাথে মিলিয়ে */
    }

    /* রুটিন স্ক্রল র্যাপারের জন্য অ্যানিমেটেড বর্ডার গ্লো */
    .routine-scroll-wrapper::before {
      content: '';
      position: absolute;
      top: -2px; left: -2px; right: -2px; bottom: -2px;
      background: linear-gradient(45deg, 
        #ff0080, #ff8000, #80ff00, #00ff80, 
        #0080ff, #8000ff, #ff0080);
      background-size: 300%;
      border-radius: 26px;
      z-index: -1;
      animation: border-glow 18s linear infinite; 
      filter: blur(1px); 
    }
    
    /* গ্লাসমরফিজম টেবিল */
    table { 
      width: 100%; 
      border-collapse: separate; 
      border-spacing: 0;
      border-radius: 24px;
      overflow: hidden;
      position: relative;
      transform-origin: top left; /* জুম করার জন্য মূলবিন্দু */
      transition: transform 0.2s ease-out; /* জুম ট্রানজিশন মসৃণ করার জন্য */
      min-width: 100%; /* র্যাপারের প্রস্থের নিচে যেন না যায় */
      color: var(--text-light); /* Ensure text color changes with theme */
    }
    
    /* টেবিলের গ্লো অ্যানিমেশন র্যাপারে চলে গেছে */
    table::before {
      content: none; /* টেবিলের উপর থেকে সরিয়ে র্যাপারে নিয়ে যাওয়া হয়েছে */
    }
    
    @keyframes border-glow {
      0% { background-position: 0% 50%; }
      100% { background-position: 300% 50%; }
    }
    
    caption { 
      padding: 30px 20px;
      font-size: 38px;
      font-weight: 900;
      color: var(--text-light); /* Ensure text color changes with theme */
      text-shadow: 0 0 12px rgba(255, 255, 255, 0.2); 
      background: linear-gradient(45deg, #667eea, #764ba2);
      background-clip: text;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: caption-text-glow 7s ease-in-out infinite alternate; 
    }
    
    @keyframes caption-text-glow {
      0% { filter: drop-shadow(0 0 4px rgba(102, 126, 234, 0.15)); }
      100% { filter: drop-shadow(0 0 10px rgba(118, 75, 162, 0.4)); }
    }
    
    th, td { 
      padding: 18px 12px; 
      text-align: center; 
      border: 1px solid var(--glass-border); /* Use glass-border */
      transition: all 0.1s ease-out; 
      position: relative;
      overflow: hidden; 
    }

    th:first-child, td:first-child {
      border-left: none;
    }
    th:last-child, td:last-child {
      border-right: none;
    }
    tr:first-child th {
      border-top: none;
    }
    tr:last-child td {
      border-bottom: none;
    }
    
    thead th { 
      background: rgba(0, 0, 0, 0.12); 
      backdrop-filter: blur(6px); 
      color: var(--text-light); 
      font-weight: bold;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1); 
      cursor: default;
    }

    thead th:hover {
        transform: translateY(-0.2px); 
        box-shadow: 0 1px 4px rgba(0, 0, 0, 0.08); 
    }
    
    tbody td {
      background: rgba(255, 255, 255, 0.02); 
      color: var(--text-light);
      cursor: pointer;
    }
    
    tbody td:hover {
      background: rgba(255, 255, 255, 0.08); 
      transform: translateY(-0.3px) scale(1.001); 
      box-shadow: 0 2px 8px rgba(255, 255, 255, 0.04); 
      z-index: 10;
    }
    
    tbody td:first-child { 
      background: rgba(0, 0, 0, 0.18); 
      backdrop-filter: blur(8px); 
      color: var(--accent-gold); 
      font-weight: 900;
      text-shadow: 0 1px 4px rgba(255, 215, 0, 0.2); 
      cursor: default;
    }
    
    /* বর্তমান দিনের স্টাইলিং */
    .today-row td:first-child { 
      position: relative;
      background: var(--current-day-bg);
      backdrop-filter: blur(13px); 
      border-radius: 16px;
      overflow: hidden;
      animation: day-pulse 5s ease-in-out infinite alternate; 
    }
    
    .today-row td:first-child::before { 
      content: '';
      position: absolute;
      top: -3px; left: -3px; right: -3px; bottom: -3px;
      background: linear-gradient(45deg, 
        #ff0066, #ff3300, #ff6600, #ffaa00, #ffff00, 
        #99ff00, #00ff66, #00ffcc, #0099ff, #3300ff, 
        #9900ff, #ff0099, #ff0066);
      background-size: 400% 400%;
      border-radius: 18px;
      z-index: -1;
      animation: rainbow-glow 8s linear infinite; 
      filter: blur(2px); 
    }
    
    .today-row td:first-child::after {
      content: '';
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      background: radial-gradient(circle at center, 
        rgba(255, 255, 255, 0.08) 0%, transparent 70%); 
      animation: shimmer 4s ease-in-out infinite alternate; 
    }
    
    @keyframes rainbow-glow { 
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    
    @keyframes day-pulse { 
      0% { 
        box-shadow: 0 0 12px rgba(255, 0, 150, 0.5), 
                   inset 0 0 12px rgba(255, 255, 255, 0.04);
      }
      100% { 
        box-shadow: 0 0 25px rgba(0, 255, 255, 0.5), 
                   inset 0 0 15px rgba(255, 255, 255, 0.08);
      }
    }
    
    @keyframes shimmer {
      0% { opacity: 0.1; }
      100% { opacity: 0.4; }
    }
    
    /* বর্তমান ক্লাসের স্টাইলিং */
    .current-class { 
      position: relative;
      background: var(--current-class-bg);
      background-size: 300% 300%;
      backdrop-filter: blur(9px); 
      border-radius: 12px;
      color: var(--button-text) !important; /* Use button-text for consistency */
      font-weight: bold;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3); 
      animation: class-gradient 9s ease infinite, class-glow 4s ease-in-out infinite alternate; 
      overflow: hidden;
    }
    
    .current-class::before {
      content: '';
      position: absolute;
      top: -2px; left: -2px; right: -2px; bottom: -2px;
      background: linear-gradient(45deg, 
        #ff0080, #ff8000, #80ff00, #00ff80, #0080ff, #8000ff, #ff0080);
      background-size: 400%;
      border-radius: 14px;
      z-index: -1;
      animation: current-class-border 7s linear infinite; 
      filter: blur(0.8px); 
    }
    
    @keyframes class-gradient {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    
    @keyframes class-glow {
      0% { 
        box-shadow: 0 0 12px rgba(255, 107, 107, 0.3), 
                   0 0 25px rgba(255, 217, 61, 0.15);
      }
      100% { 
        box-shadow: 0 0 18px rgba(107, 207, 127, 0.3), 
                   0 0 35px rgba(69, 183, 209, 0.15);
      }
    }
    
    @keyframes current-class-border {
      0% { background-position: 0% 50%; }
      100% { background-position: 400% 50%; }
    }
    
    /* বর্তমান সময়ের স্টাইলিং */
    .current-time { 
      position: relative;
      background: linear-gradient(135deg, 
        rgba(102, 126, 234, 0.5), rgba(118, 75, 162, 0.5), 
        rgba(240, 147, 251, 0.5), rgba(245, 87, 108, 0.5)); 
      background-size: 300% 300%;
      backdrop-filter: blur(9px); 
      color: var(--button-text) !important; /* Use button-text for consistency */
      font-weight: bold;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2); 
      animation: time-gradient 8s ease infinite, time-glow 3.5s ease-in-out infinite alternate; 
      border-bottom: 3px solid transparent;
      border-image: linear-gradient(90deg, #ff0080, #00ff80, #0080ff, #ff8000) 1;
    }
    
    @keyframes time-gradient {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    
    @keyframes time-glow {
      0% { box-shadow: 0 2px 8px rgba(102, 126, 234, 0.25); }
      100% { box-shadow: 0 4px 15px rgba(245, 87, 108, 0.4); }
    }
    
    .class-name { 
      font-weight: bold; 
      color: var(--text-light); /* Ensure text color changes with theme */
      margin-bottom: 4px;
      font-size: 16px;
    }
    
    .class-info { 
      font-size: 12px; 
      color: var(--text-light); /* Ensure text color changes with theme */
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 5px;
    }
    
    .class-info a {
      color: #00e6e6;
      text-decoration: none;
      transition: color 0.3s ease, text-shadow 0.3s ease;
    }
    
    .class-info a:hover {
      color: #ff6b6b;
      text-shadow: 0 0 5px rgba(255, 107, 107, 0.5);
    }

    /* শিক্ষক প্রোফাইল পপ-আপ স্টাইল */
    .teacher-modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.6); 
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.3s ease, visibility 0.3s ease;
    }

    .teacher-modal-overlay.active {
        opacity: 1;
        visibility: visible;
    }

    .teacher-modal-content {
        background: var(--modal-bg); 
        backdrop-filter: blur(25px);
        -webkit-backdrop-filter: blur(25px);
        border: 1px solid var(--modal-border);
        border-radius: 20px;
        padding: 30px;
        color: var(--text-light);
        text-align: center;
        box-shadow: 0 10px 40px var(--modal-shadow), inset 0 1px 0 rgba(255, 255, 255, 0.2);
        max-width: 400px;
        width: 90%;
        transform: scale(0.9);
        opacity: 0;
        transition: transform 0.3s ease, opacity 0.3s ease;
        position: relative;
    }

    .teacher-modal-overlay.active .teacher-modal-content {
        transform: scale(1);
        opacity: 1;
    }

    .teacher-modal-content h3 {
        font-size: 28px;
        font-weight: 900;
        margin-bottom: 5px; 
        background: linear-gradient(45deg, #a770ef, #cf8bf3, #fbc2eb);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        text-shadow: 0 0 10px rgba(251, 194, 235, 0.7);
    }

    .teacher-modal-content .english-name {
        font-family: 'Inter', sans-serif; 
        font-size: 18px;
        color: var(--text-light); /* Ensure text color changes with theme */
        margin-bottom: 15px; 
    }

    .teacher-modal-content p {
        font-size: 18px;
        margin-bottom: 10px;
        color: var(--text-light); /* Ensure text color changes with theme */
    }

    .teacher-modal-content .close-button {
        position: absolute;
        top: 15px;
        right: 15px;
        background: none;
        border: none;
        font-size: 24px;
        color: var(--modal-close-btn); /* Use modal-close-btn variable */
        cursor: pointer;
        transition: color 0.3s ease, transform 0.3s ease;
    }

    .teacher-modal-content .close-button:hover {
        color: var(--text-light); /* Use text-light for hover */
        transform: rotate(90deg);
    }

    /* নতুন ভিজিট প্রোফাইল বাটন স্টাইল */
    .visit-profile-button {
        background: linear-gradient(45deg, #00c6ff, #0072ff);
        border: none;
        border-radius: 10px;
        color: var(--button-text);
        padding: 12px 25px;
        font-size: 16px;
        font-weight: bold;
        cursor: pointer;
        margin-top: 15px;
        box-shadow: 0 4px 15px rgba(0, 114, 255, 0.4);
        transition: all 0.3s ease;
        text-decoration: none; 
        display: inline-block; 
    }

    .visit-profile-button:hover {
        background: linear-gradient(45deg, #0072ff, #00c6ff);
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(0, 114, 255, 0.6);
    }

    /* সার্চ বার স্টাইল */
    .search-container {
        width: 100%;
        max-width: 600px;
        margin-bottom: 20px;
        position: relative;
        z-index: 2;
    }

    .search-input {
        width: 100%;
        padding: 15px 20px;
        border: 1px solid var(--input-border); /* Use input-border */
        border-radius: 15px;
        background: var(--input-bg); /* Use input-bg */
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        color: var(--input-color); /* Use input-color */
        font-family: 'Noto Sans Bengali', 'Inter', sans-serif;
        font-size: 18px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
    }

    .search-input::placeholder {
        color: var(--input-placeholder); /* Use input-placeholder */
    }

    .search-input:focus {
        outline: none;
        border-color: rgba(255, 255, 255, 0.4);
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2), 0 0 0 2px rgba(255, 255, 255, 0.2);
    }

    /* দিন ফিল্টার বাটন কন্টেইনার */
    .day-filter-buttons {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 10px;
        margin-bottom: 20px;
        padding: 10px;
        background: var(--glass-bg); /* Use glass-bg */
        border-radius: 15px;
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
        border: 1px solid var(--glass-border);
        box-shadow: 0 2px 10px var(--glass-shadow);
    }

    .day-filter-button {
        background: rgba(255, 255, 255, 0.15);
        border: 1px solid var(--glass-border);
        border-radius: 10px;
        color: var(--text-light);
        padding: 10px 18px;
        font-size: 16px;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s ease;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }

    .day-filter-button:hover {
        background: rgba(255, 255, 255, 0.25);
        transform: translateY(-1px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }

    .day-filter-button.active {
        background: linear-gradient(45deg, #00c6ff, #0072ff);
        border-color: #0072ff;
        box-shadow: 0 4px 10px rgba(0, 114, 255, 0.5);
        transform: translateY(-1px);
    }

    /* কাউন্টডাউন টাইমার স্টাইল (উইজেটের ভিতরে) */
    #countdown-timer-display {
        background: var(--countdown-bg);
        border: 1px solid var(--countdown-border);
        border-radius: 10px;
        padding: 10px 15px;
        margin-top: 15px;
        display: none; /* Hidden by default, controlled by JS */
        flex-direction: column;
        align-items: center;
        justify-content: center;
        font-family: 'Inter', sans-serif;
        font-weight: bold;
        color: var(--countdown-text);
        box-shadow: inset 0 1px 3px rgba(255, 255, 255, 0.1);
    }

    #countdown-timer-display.visible {
        display: flex;
    }

    #countdown-timer-display .countdown-label {
        font-size: 14px;
        opacity: 0.8;
        margin-bottom: 5px;
        display: block;
    }

    #countdown-timer-display .countdown-time {
        font-size: 28px;
        color: #00e6e6; /* Aqua color for time */
        text-shadow: 0 0 8px var(--countdown-glow);
    }

    /* LLM প্রশ্ন পপ-আপ স্টাইল */
    .llm-modal-overlay { 
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.6); 
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1001; 
        opacity: 0;
        visibility: hidden;
        transform: scale(0.95);
        transition: opacity 0.3s ease, visibility 0.3s ease, transform 0.3s ease;
    }

    .llm-modal-overlay.active {
        opacity: 1;
        visibility: visible;
        transform: scale(1);
    }

    .llm-modal-overlay .modal-content {
        background: var(--modal-bg); 
        backdrop-filter: blur(25px);
        -webkit-backdrop-filter: blur(25px);
        border: 1px solid var(--modal-border);
        border-radius: 20px;
        padding: 30px;
        color: var(--text-light);
        text-align: center;
        box-shadow: 0 10px 40px var(--modal-shadow), inset 0 1px 0 rgba(255, 255, 255, 0.2);
        max-width: 600px;
        width: 90%;
        transform: scale(0.9);
        opacity: 0;
        transition: transform 0.3s ease, opacity 0.3s ease;
        position: relative;
        display: flex;
        flex-direction: column;
        gap: 15px;
    }

    .llm-modal-overlay.active .modal-content {
        transform: scale(1);
        opacity: 1;
    }

    .llm-modal-overlay .modal-content h3 {
        font-size: 28px;
        font-weight: 900;
        margin-bottom: 10px;
        background: linear-gradient(45deg, #f093fb, #f5576c);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        text-shadow: 0 0 10px rgba(240, 147, 251, 0.7);
    }

    .llm-modal-overlay .modal-content textarea {
        width: 100%;
        min-height: 80px;
        padding: 10px 15px;
        border: 1px solid var(--input-border);
        border-radius: 10px;
        background: var(--input-bg);
        color: var(--input-color);
        font-family: 'Noto Sans Bengali', sans-serif;
        font-size: 16px;
        resize: vertical;
        outline: none;
        transition: border-color 0.3s ease;
    }

    .llm-modal-overlay .modal-content textarea:focus {
        border-color: rgba(255, 255, 255, 0.5);
    }

    .llm-modal-overlay .modal-content button {
        background: linear-gradient(45deg, #2af598, #009efd);
        border: none;
        border-radius: 10px;
        color: var(--button-text);
        padding: 12px 25px;
        font-size: 16px;
        font-weight: bold;
        cursor: pointer;
        box-shadow: 0 4px 15px rgba(42, 245, 152, 0.4);
        transition: all 0.3s ease;
    }

    .llm-modal-overlay .modal-content button:hover {
        background: linear-gradient(45deg, #009efd, #2af598);
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(42, 245, 152, 0.6);
    }

    .llm-modal-overlay .modal-content .response-area {
        background: var(--response-area-bg);
        border: 1px solid var(--response-area-border);
        border-radius: 10px;
        padding: 15px;
        min-height: 100px;
        text-align: left;
        font-size: 15px;
        line-height: 1.6;
        overflow-y: auto;
        max-height: 200px;
        white-space: pre-wrap; /* Preserve whitespace and wrap text */
        word-wrap: break-word; /* Break long words */
        color: var(--text-light); /* Ensure text color changes with theme */
    }

    .llm-modal-overlay .modal-content .loading-spinner {
        border: 4px solid rgba(255, 255, 255, 0.3);
        border-top: 4px solid #00e6e6;
        border-radius: 50%;
        width: 30px;
        height: 30px;
        animation: spin 1s linear infinite;
        margin: 10px auto;
        display: none; /* Hidden by default */
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    /* LLM প্রশ্ন বাটন */
    .ask-gemini-button {
        background: linear-gradient(45deg, #f093fb, #f5576c);
        border: none;
        border-radius: 8px;
        color: var(--button-text);
        padding: 6px 10px;
        font-size: 12px;
        font-weight: bold;
        cursor: pointer;
        margin-top: 5px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        transition: all 0.2s ease;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 5px;
    }

    .ask-gemini-button:hover {
        background: linear-gradient(45deg, #f5576c, #f093fb);
        transform: translateY(-1px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    }

    /* নতুন ক্লাস সারাংশ বাটন */
    .class-summary-button {
        background: linear-gradient(45deg, #2af598, #009efd); 
        border: none;
        border-radius: 8px;
        color: var(--button-text);
        padding: 6px 10px;
        font-size: 12px;
        font-weight: bold;
        cursor: pointer;
        margin-top: 5px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        transition: all 0.2s ease;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 5px;
    }

    .class-summary-button:hover {
        background: linear-gradient(45deg, #009efd, #2af598);
        transform: translateY(-1px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    }

    /* টগল বাটন কন্টেইনার */
    .toggle-buttons-container {
        display: flex;
        justify-content: center;
        gap: 15px;
        margin-bottom: 20px;
        padding: 10px;
        background: var(--glass-bg);
        border-radius: 15px;
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
        border: 1px solid var(--glass-border);
        box-shadow: 0 2px 10px var(--glass-shadow);
    }

    .toggle-button {
        background: rgba(255, 255, 255, 0.15);
        border: 1px solid var(--glass-border);
        border-radius: 10px;
        color: var(--text-light);
        padding: 10px 20px;
        font-size: 18px;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s ease;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }

    .toggle-button:hover {
        background: rgba(255, 255, 255, 0.25);
        transform: translateY(-1px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }

    .toggle-button.active {
        background: linear-gradient(45deg, #f093fb, #f5576c);
        border-color: #f5576c;
        box-shadow: 0 4px 10px rgba(245, 87, 108, 0.5);
        transform: translateY(-1px);
    }

    /* থিম টগল বাটন */
    .theme-toggle-container {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 10px;
        margin-top: 20px;
        margin-bottom: 20px;
        padding: 10px 15px;
        background: var(--glass-bg);
        border-radius: 15px;
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
        border: 1px solid var(--glass-border);
        box-shadow: 0 2px 10px var(--glass-shadow);
    }

    .theme-toggle-label {
        font-size: 18px;
        font-weight: bold;
        color: var(--text-light);
    }

    .theme-switch {
        position: relative;
        display: inline-block;
        width: 60px;
        height: 34px;
    }

    .theme-switch input {
        opacity: 0;
        width: 0;
        height: 0;
    }

    .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #ccc;
        -webkit-transition: .4s;
        transition: .4s;
        border-radius: 34px;
    }

    .slider:before {
        position: absolute;
        content: "";
        height: 26px;
        width: 26px;
        left: 4px;
        bottom: 4px;
        background-color: white;
        -webkit-transition: .4s;
        transition: .4s;
        border-radius: 50%;
    }

    input:checked + .slider {
        background-color: #2196F3;
    }

    input:focus + .slider {
        box-shadow: 0 0 1px #2196F3;
    }

    input:checked + .slider:before {
        -webkit-transform: translateX(26px);
        -ms-transform: translateX(26px);
        transform: translateX(26px);
    }

    /* Rounded sliders */
    .slider.round {
        border-radius: 34px;
    }

    .slider.round:before {
        border-radius: 50%;
    }

    /* কাস্টম মেসেজ বক্স */
    #messageBoxOverlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(5px);
        -webkit-backdrop-filter: blur(5px);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 2000; /* Higher than all other modals */
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.3s ease, visibility 0.3s ease;
    }

    #messageBoxOverlay.active {
        opacity: 1;
        visibility: visible;
    }

    #messageBox {
        background: var(--message-box-bg);
        border: 1px solid var(--message-box-border);
        border-radius: 15px;
        padding: 25px;
        text-align: center;
        box-shadow: 0 8px 25px var(--message-box-shadow);
        max-width: 350px;
        width: 90%;
        color: var(--message-box-text);
        transform: translateY(-20px);
        opacity: 0;
        transition: transform 0.3s ease, opacity 0.3s ease;
    }

    #messageBoxOverlay.active #messageBox {
        transform: translateY(0);
        opacity: 1;
    }

    #messageBox p {
        font-size: 18px;
        font-weight: bold;
        margin-bottom: 20px;
    }

    #messageBox button {
        background-color: rgba(255, 255, 255, 0.2);
        border: 1px solid rgba(255, 255, 255, 0.4);
        border-radius: 8px;
        color: white;
        padding: 10px 20px;
        font-size: 16px;
        cursor: pointer;
        transition: background-color 0.3s ease, transform 0.2s ease;
    }

    #messageBox button:hover {
        background-color: rgba(255, 255, 255, 0.3);
        transform: translateY(-1px);
    }

    /* কপি বাটন */
    .copy-button {
        background: var(--copy-button-bg);
        border: none;
        border-radius: 8px;
        color: var(--button-text);
        padding: 8px 15px;
        font-size: 14px;
        font-weight: bold;
        cursor: pointer;
        margin-top: 10px;
        box-shadow: 0 2px 5px var(--copy-button-shadow);
        transition: all 0.2s ease;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 5px;
    }

    .copy-button:hover {
        background: var(--copy-button-hover-bg);
        transform: translateY(-1px);
        box-shadow: 0 4px 8px var(--copy-button-shadow);
    }

    /* LLM উত্তর মোড টগল */
    .llm-response-mode-toggle-container {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 10px;
        margin-bottom: 15px;
        padding: 8px 12px;
        background: var(--glass-bg);
        border-radius: 12px;
        backdrop-filter: blur(6px);
        -webkit-backdrop-filter: blur(6px);
        border: 1px solid var(--glass-border);
        box-shadow: 0 2px 8px var(--glass-shadow);
    }

    .llm-response-mode-label {
        font-size: 16px;
        font-weight: bold;
        color: var(--text-light);
    }


    /* রেসপনসিভ ডিজাইন */
    @media (max-width: 1024px) {
        caption { font-size: 28px; }
        th, td { padding: 12px 8px; font-size: 13px; }
        .class-name { font-size: 13px; }
        .class-info { font-size: 9px; }
        #dynamic-class-widget h2 { font-size: 20px; }
        #dynamic-class-widget p { font-size: 16px; }
        #dynamic-class-widget .teacher-name-bangla { font-size: 18px; }
        #dynamic-class-widget .teacher-name-english { font-size: 14px; }
        .teacher-modal-content h3 { font-size: 24px; }
        .teacher-modal-content .english-name { font-size: 16px; }
        .teacher-modal-content p { font-size: 16px; }
        .visit-profile-button { padding: 10px 20px; font-size: 15px; }
        .search-input { padding: 12px 15px; font-size: 16px; }
        .day-filter-button { padding: 8px 15px; font-size: 14px; }
        #countdown-timer-display { padding: 10px 12px; }
        #countdown-timer-display .countdown-time { font-size: 24px; }
        .llm-modal-overlay .modal-content { padding: 20px; }
        .llm-modal-overlay .modal-content h3 { font-size: 24px; }
        .llm-modal-overlay .modal-content textarea { font-size: 14px; }
        .llm-modal-overlay .modal-content button { padding: 10px 20px; font-size: 14px; }
        .llm-modal-overlay .modal-content .response-area { font-size: 13px; }
        .ask-gemini-button, .class-summary-button { padding: 5px 8px; font-size: 11px; }
        .toggle-button { padding: 8px 15px; font-size: 16px; }
        .zoom-level { font-size: 16px; }
        .theme-toggle-label { font-size: 16px; }
        #messageBox p { font-size: 16px; }
        #messageBox button { font-size: 14px; padding: 8px 16px; }
        .copy-button { padding: 6px 12px; font-size: 12px; }
        .llm-response-mode-label { font-size: 14px; }
    }

    @media (max-width: 768px) {
      body { padding: 10px; }
      caption { font-size: 22px; padding: 16px 7px; }
      th, td { padding: 8px 4px; font-size: 11px; }
      .class-name { font-size: 12px; }
      .class-info { font-size: 8px; }
      #dynamic-class-widget h2 { font-size: 16px; }
      #dynamic-class-widget p { font-size: 14px; }
      #dynamic-class-widget .teacher-name-bangla { font-size: 16px; }
      #dynamic-class-widget .teacher-name-english { font-size: 12px; }
      .teacher-modal-content h3 { font-size: 20px; }
      .teacher-modal-content .english-name { font-size: 14px; }
      .teacher-modal-content p { font-size: 14px; }
      .teacher-modal-content { padding: 20px; }
      .visit-profile-button { padding: 8px 18px; font-size: 14px; }
      .search-input { padding: 10px 12px; font-size: 14px; }
      .day-filter-button { padding: 6px 12px; font-size: 12px; }
      .day-filter-buttons { gap: 8px; padding: 8px; }
      #countdown-timer-display { padding: 8px 10px; }
      #countdown-timer-display .countdown-time { font-size: 20px; }
      #countdown-timer-display .countdown-label { font-size: 12px; }
      .llm-modal-overlay .modal-content { padding: 15px; }
      .llm-modal-overlay .modal-content h3 { font-size: 20px; }
      .llm-modal-overlay .modal-content textarea { font-size: 12px; min-height: 60px; }
      .llm-modal-overlay .modal-content button { padding: 8px 18px; font-size: 12px; }
      .llm-modal-overlay .modal-content .response-area { font-size: 11px; min-height: 80px; }
      .ask-gemini-button, .class-summary-button { padding: 4px 6px; font-size: 10px; }
      .toggle-button { padding: 6px 12px; font-size: 14px; }
      .toggle-buttons-container { gap: 10px; padding: 8px; }
      .zoom-level { font-size: 14px; }
      .theme-toggle-label { font-size: 14px; }
      #messageBox p { font-size: 14px; }
      #messageBox button { font-size: 12px; padding: 6px 12px; }
      .copy-button { padding: 5px 10px; font-size: 11px; }
      .llm-response-mode-label { font-size: 12px; }
    }

    @media (max-width: 480px) {
        caption { font-size: 18px; }
        th, td { padding: 6px 2px; font-size: 10px; }
        .class-name { font-size: 11px; }
        .class-info { font-size: 7px; }
        #dynamic-class-widget { padding: 10px; }
        #dynamic-class-widget h2 { font-size: 14px; }
        #dynamic-class-widget p { font-size: 12px; }
        #dynamic-class-widget .teacher-name-bangla { font-size: 14px; }
        #dynamic-class-widget .teacher-name-english { font-size: 10px; }
        .teacher-modal-content h3 { font-size: 18px; }
        .teacher-modal-content .english-name { font-size: 12px; }
        .teacher-modal-content p { font-size: 12px; }
        .teacher-modal-content { padding: 15px; }
        .visit-profile-button { padding: 6px 15px; font-size: 12px; }
        .search-input { padding: 8px 10px; font-size: 12px; }
        .day-filter-button { padding: 5px 10px; font-size: 11px; }
        .day-filter-buttons { gap: 5px; padding: 5px; }
        #countdown-timer-display { padding: 6px 8px; }
        #countdown-timer-display .countdown-time { font-size: 18px; }
        #countdown-timer-display .countdown-label { font-size: 10px; }
        .llm-modal-overlay .modal-content { padding: 10px; }
        .llm-modal-overlay .modal-content h3 { font-size: 16px; }
        .llm-modal-overlay .modal-content textarea { font-size: 10px; min-height: 50px; }
        .llm-modal-overlay .modal-content button { padding: 6px 12px; font-size: 10px; }
        .llm-modal-overlay .modal-content .response-area { font-size: 10px; min-height: 60px; }
        .ask-gemini-button, .class-summary-button { padding: 3px 5px; font-size: 9px; }
        .toggle-button { padding: 5px 10px; font-size: 12px; }
        .toggle-buttons-container { gap: 8px; padding: 6px; }
        .zoom-level { font-size: 12px; }
        .theme-toggle-label { font-size: 12px; }
        #messageBox p { font-size: 12px; }
        #messageBox button { font-size: 10px; padding: 5px 10px; }
        .copy-button { padding: 4px 8px; font-size: 10px; }
        .llm-response-mode-label { font-size: 10px; }
    }
    
    /* লোডিং অ্যানিমেশন */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    table, #dynamic-class-widget { animation: fadeIn 1s ease-out; }
  </style>
</head>
<body>
  <div class="particles"></div>
  
  <div class="container">
    <!-- থিম টoggle বাটন -->
    <div class="theme-toggle-container">
        <span class="theme-toggle-label">ডার্ক মোড</span>
        <label class="theme-switch">
            <input type="checkbox" id="themeToggle">
            <span class="slider round"></span>
        </label>
        <span class="theme-toggle-label">লাইট মোড</span>
    </div>

    <!-- টoggle বাটন -->
    <div class="toggle-buttons-container">
        <button id="currentClassBtn" class="toggle-button">বর্তমান ক্লাস</button>
        <button id="upcomingClassBtn" class="toggle-button active">পরবর্তী ক্লাস</button>
    </div>

    <!-- ডায়নামিক ক্লাস উইজেট -->
    <div id="dynamic-class-widget">
      <h2 id="widget-title">পরবর্তী ক্লাস:</h2>
      <p id="widget-subject"></p>
      <p id="widget-time"></p>
      <p id="widget-teacher-bangla" class="teacher-name-bangla"></p>
      <p id="widget-teacher-english" class="teacher-name-english"></p>
      <div id="widget-profile-button-container"></div>
      <!-- কাউন্টডাউন টাইমার উইজেটের ভিতরে -->
      <div id="countdown-timer-display">
        <span class="countdown-label">শুরু হতে বাকি:</span>
        <span class="countdown-time" id="countdown-time"></span>
      </div>
    </div>

    <!-- সার্চ বার -->
    <div class="search-container">
        <input type="text" id="searchInput" class="search-input" placeholder="ক্লাস, শিক্ষক বা রুম নম্বর খুঁজুন...">
    </div>

    <!-- দিন ফিল্টার বাটন -->
    <div class="day-filter-buttons" id="dayFilterButtons">
        <button class="day-filter-button" data-day-index="0">রবিবার</button>
        <button class="day-filter-button" data-day-index="1">সোমবার</button>
        <button class="day-filter-button" data-day-index="2">মঙ্গলবার</button>
        <button class="day-filter-button" data-day-index="3">বুধবার</button>
        <button class="day-filter-button" data-day-index="4">বৃহস্পতিবার</button>
        <button class="day-filter-button active" data-day-index="all">সব দিন দেখুন</button>
    </div>

    <!-- জুম কন্ট্রোল (বাটনগুলো সরানো হয়েছে) -->
    <div class="zoom-controls">
      <span id="zoomLevelDisplay" class="zoom-level">100%</span>
    </div>

    <!-- রুটিন টেবিলের জন্য স্ক্রলযোগ্য র্যাপার -->
    <div class="routine-scroll-wrapper">
      <table id="routine">
        <caption>দৈনিক পাঠদান সূচি (সায়েন্স) ২০২৫-২৬</caption>
        <thead>
          <tr>
            <th>বার</th>
            <th>০৯:৩০–১০:১০</th>
            <th>১০:১০–১০:৫০</th>
            <th>১০:৫০–১১:৩০</th>
            <th>১১:৩০–১২:১০</th>
            <th>১২:১০–১২:৫০</th>
            <th>১২:৫০–০১:৩০</th>
          </tr>
        </thead>
        <tbody>
          <!-- রবিবার -->
          <tr data-day-name="রবিবার">
            <td>রবিবার</td>
            <td>
              <div class="class-name" data-subject="রসায়ন">রসায়ন</div>
              <div class="class-info">107 | <a href="#" data-teacher-id="MS">MS</a></div>
              <button class="ask-gemini-button" data-subject="রসায়ন">প্রশ্ন করুন ✨</button>
              <button class="class-summary-button" data-subject="রসায়ন">সারাংশ ও প্রস্তুতি ✨</button>
            </td>
            <td>
              <div class="class-name" data-subject="উচ্চতর গণিত">উচ্চতর গণিত</div>
              <div class="class-info">107 | <a href="#" data-teacher-id="RI">RI</a></div>
              <button class="ask-gemini-button" data-subject="উচ্চতর গণিত">প্রশ্ন করুন ✨</button>
              <button class="class-summary-button" data-subject="উচ্চতর গণিত">সারাংশ ও প্রস্তুতি ✨</button>
            </td>
            <td>
              <div class="class-name" data-subject="বাংলা">বাংলা</div>
              <div class="class-info">101 | <a href="#" data-teacher-id="JHA">JHA</a></div>
              <button class="ask-gemini-button" data-subject="বাংলা">প্রশ্ন করুন ✨</button>
              <button class="class-summary-button" data-subject="বাংলা">সারাংশ ও প্রস্তুতি ✨</button>
            </td>
            <td>
              <div class="class-name" data-subject="ইংরেজি">ইংরেজি</div>
              <div class="class-info">101 | <span data-teacher-id="AKC">AKC</span></div>
              <button class="ask-gemini-button" data-subject="ইংরেজি">প্রশ্ন করুন ✨</button>
              <button class="class-summary-button" data-subject="ইংরেজি">সারাংশ ও প্রস্তুতি ✨</button>
            </td>
            <td>
              <div class="class-name" data-subject="পদার্থবিদ্যা">পদার্থবিদ্যা</div>
              <div class="class-info">107 | <a href="#" data-teacher-id="MIH">MIH</a></div>
              <button class="ask-gemini-button" data-subject="পদার্থবিদ্যা">প্রশ্ন করুন ✨</button>
              <button class="class-summary-button" data-subject="পদার্থবিদ্যা">সারাংশ ও প্রস্তুতি ✨</button>
            </td>
            <td>
              <div class="class-name" data-subject="উদ্ভিদবিদ্যা">উদ্ভিদবিদ্যা</div>
              <div class="class-info">107 | <a href="#" data-teacher-id="MMB">MMB</a></div>
              <button class="ask-gemini-button" data-subject="উদ্ভিদবিদ্যা">প্রশ্ন করুন ✨</button>
              <button class="class-summary-button" data-subject="উদ্ভিদবিদ্যা">সারাংশ ও প্রস্তুতি ✨</button>
            </td>
          </tr>
          
          <!-- সোমবার -->
          <tr data-day-name="সোমবার">
            <td>সোমবার</td>
            <td>
              <div class="class-name" data-subject="পদার্থবিদ্যা">পদার্থবিদ্যা</div>
              <div class="class-info">107 | <a href="#" data-teacher-id="MIH">MIH</a></div>
              <button class="ask-gemini-button" data-subject="পদার্থবিদ্যা">প্রশ্ন করুন ✨</button>
              <button class="class-summary-button" data-subject="পদার্থবিদ্যা">সারাংশ ও প্রস্তুতি ✨</button>
            </td>
            <td>
              <div class="class-name" data-subject="উচ্চতর গণিত">উচ্চতর গণিত</div>
              <div class="class-info">107 | <a href="#" data-teacher-id="MSA">MSA</a></div>
              <button class="ask-gemini-button" data-subject="উচ্চতর গণিত">প্রশ্ন করুন ✨</button>
              <button class="class-summary-button" data-subject="উচ্চতর গণিত">সারাংশ ও প্রস্তুতি ✨</button>
            </td>
            <td>
              <div class="class-name" data-subject="ইংরেজি">ইংরেজি</div>
              <div class="class-info">101 | <a href="#" data-teacher-id="SZH">SZH</a></div>
              <button class="ask-gemini-button" data-subject="ইংরেজি">প্রশ্ন করুন ✨</button>
              <button class="class-summary-button" data-subject="ইংরেজি">সারাংশ ও প্রস্তুতি ✨</button>
            </td>
            <td>
              <div class="class-name" data-subject="তথ্য ও যোগাযোগ">তথ্য ও যোগাযোগ</div>
              <div class="class-info">101 | <a href="#" data-teacher-id="SH">SH</a></div>
              <button class="ask-gemini-button" data-subject="তথ্য ও যোগাযোগ">প্রশ্ন করুন ✨</button>
              <button class="class-summary-button" data-subject="তথ্য ও যোগাযোগ">সারাংশ ও প্রস্তুতি ✨</button>
            </td>
            <td>
              <div class="class-name" data-subject="রসায়ন">রসায়ন</div>
              <div class="class-info">107 | <a href="#" data-teacher-id="JHA">JHA</a></div>
              <button class="ask-gemini-button" data-subject="রসায়ন">প্রশ্ন করুন ✨</button>
              <button class="class-summary-button" data-subject="রসায়ন">সারাংশ ও প্রস্তুতি ✨</button>
            </td>
            <td>
              <div class="class-name" data-subject="প্রাণিবিদ্যা">প্রাণিবিদ্যা</div>
              <div class="class-info">107 | <a href="#" data-teacher-id="Y">Y</a></div>
              <button class="ask-gemini-button" data-subject="প্রাণিবিদ্যা">প্রশ্ন করুন ✨</button>
              <button class="class-summary-button" data-subject="প্রাণিবিদ্যা">সারাংশ ও প্রস্তুতি ✨</button>
            </td>
          </tr>
          
          <!-- মঙ্গলবার -->
          <tr data-day-name="মঙ্গলবার">
            <td>মঙ্গলবার</td>
            <td>
              <div class="class-name" data-subject="রসায়ন">রসায়ন</div>
              <div class="class-info">107 | <a href="#" data-teacher-id="MS">MS</a></div>
              <button class="ask-gemini-button" data-subject="রসায়ন">প্রশ্ন করুন ✨</button>
              <button class="class-summary-button" data-subject="রসায়ন">সারাংশ ও প্রস্তুতি ✨</button>
            </td>
            <td>
              <div class="class-name" data-subject="উচ্চতর গণিত">উচ্চতর গণিত</div>
              <div class="class-info">107 | <a href="#" data-teacher-id="RI">RI</a></div>
              <button class="ask-gemini-button" data-subject="উচ্চতর গণিত">প্রশ্ন করুন ✨</button>
              <button class="class-summary-button" data-subject="উচ্চতর গণিত">সারাংশ ও প্রস্তুতি ✨</button>
            </td>
            <td>
              <div class="class-name" data-subject="বাংলা">বাংলা</div>
              <div class="class-info">101 | <a href="#" data-teacher-id="MLA">MLA</a></div>
              <button class="ask-gemini-button" data-subject="বাংলা">প্রশ্ন করুন ✨</button>
              <button class="class-summary-button" data-subject="বাংলা">সারাংশ ও প্রস্তুতি ✨</button>
            </td>
            <td>
              <div class="class-name" data-subject="প্রাণিবিদ্যা">প্রাণিবিদ্যা</div>
              <div class="class-info">107 | <a href="#" data-teacher-id="AA">AA</a></div>
              <button class="ask-gemini-button" data-subject="প্রাণিবিদ্যা">প্রশ্ন করুন ✨</button>
              <button class="class-summary-button" data-subject="প্রাণিবিদ্যা">সারাংশ ও প্রস্তুতি ✨</button>
            </td>
            <td>
              <div class="class-name" data-subject="তথ্য ও যোগাযোগ">তথ্য ও যোগাযোগ</div>
              <div class="class-info">101 | <a href="#" data-teacher-id="MIH">MIH</a></div>
              <button class="ask-gemini-button" data-subject="তথ্য ও যোগাযোগ">প্রশ্ন করুন ✨</button>
              <button class="class-summary-button" data-subject="তথ্য ও যোগাযোগ">সারাংশ ও প্রস্তুতি ✨</button>
            </td>
            <td>
              <div class="class-name" data-subject="উদ্ভিদবিদ্যা">উদ্ভিদবিদ্যা</div>
              <div class="class-info">107 | <a href="#" data-teacher-id="FE">FE</a></div>
              <button class="ask-gemini-button" data-subject="উদ্ভিদবিদ্যা">প্রশ্ন করুন ✨</button>
              <button class="class-summary-button" data-subject="উদ্ভিদবিদ্যা">সারাংশ ও প্রস্তুতি ✨</button>
            </td>
          </tr>
          
          <!-- বুধবার -->
          <tr data-day-name="বুধবার">
            <td>বুধবার</td>
            <td>
              <div class="class-name" data-subject="পদার্থবিদ্যা">পদার্থবিদ্যা</div>
              <div class="class-info">107 | <a href="#" data-teacher-id="MTH">MTH</a></div>
              <button class="ask-gemini-button" data-subject="পদার্থবিদ্যা">প্রশ্ন করুন ✨</button>
              <button class="class-summary-button" data-subject="পদার্থবিদ্যা">সারাংশ ও প্রস্তুতি ✨</button>
            </td>
            <td>
              <div class="class-name" data-subject="প্রাণিবিদ্যা">প্রাণিবিদ্যা</div>
              <div class="class-info">107 | <a href="#" data-teacher-id="AA">AA</a></div>
              <button class="ask-gemini-button" data-subject="প্রাণিবিদ্যা">প্রশ্ন করুন ✨</button>
              <button class="class-summary-button" data-subject="প্রাণিবিদ্যা">সারাংশ ও প্রস্তুতি ✨</button>
            </td>
            <td>
              <div class="class-name" data-subject="ইংরেজি">ইংরেজি</div>
              <div class="class-info">101 | <a href="#" data-teacher-id="SA">SA</a></div>
              <button class="ask-gemini-button" data-subject="ইংরেজি">প্রশ্ন করুন ✨</button>
              <button class="class-summary-button" data-subject="ইংরেজি">সারাংশ ও প্রস্তুতি ✨</button>
            </td>
            <td>
              <div class="class-name" data-subject="বাংলা">বাংলা</div>
              <div class="class-info">101 | <a href="#" data-teacher-id="JA">JA</a></div>
              <button class="ask-gemini-button" data-subject="বাংলা">প্রশ্ন করুন ✨</button>
              <button class="class-summary-button" data-subject="বাংলা">সারাংশ ও প্রস্তুতি ✨</button>
            </td>
            <td>
              <div class="class-name" data-subject="রসায়ন">রসায়ন</div>
              <div class="class-info">107 | <a href="#" data-teacher-id="MS">MS</a></div>
              <button class="ask-gemini-button" data-subject="রসায়ন">প্রশ্ন করুন ✨</button>
              <button class="class-summary-button" data-subject="রসায়ন">সারাংশ ও প্রস্তুতি ✨</button>
            </td>
            <td>
              <div class="class-name" data-subject="উদ্ভিদবিদ্যা">উদ্ভিদবিদ্যা</div>
              <div class="class-info">107 | <a href="#" data-teacher-id="MMB">MMB</a></div>
              <button class="ask-gemini-button" data-subject="উদ্ভিদবিদ্যা">প্রশ্ন করুন ✨</button>
              <button class="class-summary-button" data-subject="উদ্ভিদবিদ্যা">সারাংশ ও প্রস্তুতি ✨</button>
            </td>
          </tr>
          
          <!-- বৃহস্পতিবার -->
          <tr data-day-name="বৃহস্পতিবার">
            <td>বৃহস্পতিবার</td>
            <td>
              <div class="class-name" data-subject="প্রাণিবিদ্যা">প্রাণিবিদ্যা</div>
              <div class="class-info">107 | <a href="#" data-teacher-id="Y">Y</a></div>
              <button class="ask-gemini-button" data-subject="প্রাণিবিদ্যা">প্রশ্ন করুন ✨</button>
              <button class="class-summary-button" data-subject="প্রাণিবিদ্যা">সারাংশ ও প্রস্তুতি ✨</button>
            </td>
            <td>
              <div class="class-name" data-subject="উচ্চতর গণিত">উচ্চতর গণিত</div>
              <div class="class-info">107 | <a href="#" data-teacher-id="MSA">MSA</a></div>
              <button class="ask-gemini-button" data-subject="উচ্চতর গণিত">প্রশ্ন করুন ✨</button>
              <button class="class-summary-button" data-subject="উচ্চতর গণিত">সারাংশ ও প্রস্তুতি ✨</button>
            </td>
            <td>
              <div class="class-name" data-subject="তথ্য ও যোগাযোগ">তথ্য ও যোগাযোগ</div>
              <div class="class-info">101 | <a href="#" data-teacher-id="MIH">MIH</a></div>
              <button class="ask-gemini-button" data-subject="তথ্য ও যোগাযোগ">প্রশ্ন করুন ✨</button>
              <button class="class-summary-button" data-subject="তথ্য ও যোগাযোগ">সারাংশ ও প্রস্তুতি ✨</button>
            </td>
            <td>
              <div class="class-name" data-subject="ইংরেজি">ইংরেজি</div>
              <div class="class-info">101 | <a href="#" data-teacher-id="SZH">SZH</a></div>
              <button class="ask-gemini-button" data-subject="ইংরেজি">প্রশ্ন করুন ✨</button>
              <button class="class-summary-button" data-subject="ইংরেজি">সারাংশ ও প্রস্তুতি ✨</button>
            </td>
            <td>
              <div class="class-name" data-subject="উদ্ভিদবিদ্যা">উদ্ভিদবিদ্যা</div>
              <div class="class-info">107 | <a href="#" data-teacher-id="FE">FE</a></div>
              <button class="ask-gemini-button" data-subject="উদ্ভিদবিদ্যা">প্রশ্ন করুন ✨</button>
              <button class="class-summary-button" data-subject="উদ্ভিদবিদ্যা">সারাংশ ও প্রস্তুতি ✨</button>
            </td>
            <td>
              <div class="class-name" data-subject="পদার্থবিদ্যা">পদার্থবিদ্যা</div>
              <div class="class-info">107 | <a href="#" data-teacher-id="HR">HR</a></div>
              <button class="ask-gemini-button" data-subject="পদার্থবিদ্যা">প্রশ্ন করুন ✨</button>
              <button class="class-summary-button" data-subject="পদার্থবিদ্যা">সারাংশ ও প্রস্তুতি ✨</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- শিক্ষক প্রোফাইল পপ-আপ -->
  <div id="teacherModal" class="teacher-modal-overlay">
    <div class="teacher-modal-content">
      <button class="close-button">&times;</button>
      <h3 id="teacherNameBangla"></h3>
      <p id="teacherNameEnglish" class="english-name"></p>
      <p id="teacherDepartment"></p>
      <p id="teacherContact"></p>
      <div id="teacherProfileButtonContainer"></div> <!-- বাটন রাখার জন্য নতুন কন্টেইনার -->
    </div>
  </div>

  <!-- LLM প্রশ্ন পপ-আপ (Class Query Modal) -->
  <div id="classQueryModal" class="llm-modal-overlay"> 
    <div class="modal-content">
      <button class="close-button" id="classQueryCloseButton">&times;</button>
      <h3 id="classQuerySubjectTitle"></h3>
      <!-- নতুন LLM উত্তর মোড টগল -->
      <div class="llm-response-mode-toggle-container">
          <span class="llm-response-mode-label">সরাসরি উত্তর</span>
          <label class="theme-switch">
              <input type="checkbox" id="llmResponseModeToggle">
              <span class="slider round"></span>
          </label>
          <span class="llm-response-mode-label">বিস্তারিত উত্তর</span>
      </div>
      <textarea id="classQuestionInput" placeholder="আপনার প্রশ্ন লিখুন... (যেমন: এই ক্লাসের মূল বিষয়গুলো কী?)" rows="3"></textarea>
      <button id="askClassGeminiButton">প্রশ্ন করুন ✨</button>
      <div class="loading-spinner" id="classQueryLoadingSpinner"></div>
      <div class="response-area" id="classQueryResponseArea"></div>
      <button class="copy-button" id="copyClassQueryResponse">কপি করুন</button>
    </div>
  </div>

  <!-- LLM সারাংশ ও প্রস্তুতি পপ-আপ (Class Summary Modal) -->
  <div id="classSummaryModal" class="llm-modal-overlay"> 
    <div class="modal-content">
      <button class="close-button" id="classSummaryCloseButton">&times;</button>
      <h3 id="classSummarySubjectTitle"></h3>
      <textarea id="classSummaryInput" placeholder="কোন বিষয় সম্পর্কে জানতে চান বা কী প্রস্তুতি নিতে চান? (যেমন: ভেক্টর যোগের নিয়ম, পরবর্তী ক্লাসের জন্য কী প্রস্তুতি নেব?)" rows="3"></textarea>
      <button id="askClassSummaryButton">সারাংশ ও প্রস্তুতি তৈরি করুন ✨</button>
      <div class="loading-spinner" id="classSummaryLoadingSpinner"></div>
      <div class="response-area" id="classSummaryResponseArea"></div>
      <button class="copy-button" id="copyClassSummaryResponse">কপি করুন</button>
    </div>
  </div>

  <!-- কাস্টম মেসেজ বক্স -->
  <div id="messageBoxOverlay">
    <div id="messageBox">
      <p id="messageBoxText"></p>
      <button id="messageBoxCloseButton">ঠিক আছে</button>
    </div>
  </div>

  <script>
    const API_KEY = "AIzaSyAyKPocbERL1XmrzTkR73306yAwpIPdxPY"; 

    // ভাসমান কণা তৈরি করার ফাংশন
    function createParticles() {
      const particleContainer = document.querySelector('.particles');
      const particleCount = 20; 
      
      for (let i = 0; i < particleCount; i++) {
        const particle = document.createElement('div');
        particle.classList.add('particle');
        const size = Math.random() * 2 + 1; 
        particle.style.width = size + 'px';
        particle.style.height = size + 'px';
        particle.style.left = Math.random() * 100 + '%';
        particle.style.top = Math.random() * 100 + '%';
        particle.style.animationDelay = Math.random() * 15 + 's'; 
        particle.style.animationDuration = (Math.random() * 10 + 15) + 's'; 
        particleContainer.appendChild(particle);
      }
    }

    let particlesArray = [];
    document.addEventListener('DOMContentLoaded', () => {
        createParticles();
        particlesArray = Array.from(document.querySelectorAll('.particle'));
    });

    let pointerDown = false;
    let pointerX = 0;
    let pointerY = 0;

    function attractParticles() {
        if (!pointerDown) return;

        particlesArray.forEach(particle => {
            const particleRect = particle.getBoundingClientRect();
            const particleCenterX = particleRect.left + particleRect.width / 2;
            const particleCenterY = particleRect.top + particleRect.height / 2;

            const dx = pointerX - particleCenterX;
            const dy = pointerY - particleCenterY;
            const distance = Math.sqrt(dx * dx + dy * dy);

            const maxDistance = 300; 
            if (distance < maxDistance) {
                const force = (1 - distance / maxDistance) * 0.8; 

                const targetX = particleCenterX + dx * force * 0.1; 
                const targetY = particleCenterY + dy * force * 0.1;

                particle.style.transform = `translate(${targetX - particleCenterX}px, ${targetY - particleCenterY}px)`;
                particle.style.opacity = 0.8; 
                particle.classList.add('attracted'); 
            } else {
                particle.style.transform = ''; 
                particle.style.opacity = '';
                particle.classList.remove('attracted');
            }
        });

        requestAnimationFrame(attractParticles); 
    }

    document.body.addEventListener('pointerdown', (e) => {
        pointerDown = true;
        pointerX = e.clientX;
        pointerY = e.clientY;
        attractParticles(); 
    });

    document.body.addEventListener('pointermove', (e) => {
        if (pointerDown) {
            pointerX = e.clientX;
            pointerY = e.clientY;
        }
    });

    document.body.addEventListener('pointerup', () => {
        pointerDown = false;
        particlesArray.forEach(particle => {
            particle.style.transform = ''; 
            particle.style.opacity = '';
            particle.classList.remove('attracted');
        });
    });

    let countdownInterval; 
    let nextClassStartTime = null; 
    let hasScrolledInitially = false; 

    // ডায়নামিক উইজেট উপাদান
    const dynamicClassWidget = document.getElementById('dynamic-class-widget');
    const widgetTitle = document.getElementById('widget-title');
    const widgetSubject = document.getElementById('widget-subject');
    const widgetTime = document.getElementById('widget-time');
    const widgetTeacherBangla = document.getElementById('widget-teacher-bangla');
    const widgetTeacherEnglish = document.getElementById('widget-teacher-english');
    const widgetProfileButtonContainer = document.getElementById('widget-profile-button-container');
    const countdownTimerDisplay = document.getElementById('countdown-timer-display');
    const countdownTimeElement = document.getElementById('countdown-time');

    // টগল বাটন
    const currentClassBtn = document.getElementById('currentClassBtn');
    const upcomingClassBtn = document.getElementById('upcomingClassBtn');
    let displayMode = 'upcoming'; // ডিফল্ট মোড

    // গ্লোবাল ভেরিয়েবল যা ক্লাস ডেটা ধরে রাখবে
    let currentClassData = null;
    let nextClassData = null;
    let targetClassCellForScroll = null;

    // শেষবার যখন রুটিন ডেটা আপডেট করা হয়েছিল
    let lastRoutineUpdateTime = 0;

    function getTimeInMinutes(hour, minute) {
        return hour * 60 + minute;
    }

    const timeSlots = [
        { start: [9, 30], end: [10, 10], label: '০৯:৩০–১০:১০' },
        { start: [10, 10], end: [10, 50], label: '১০:১০–১০:৫০' },
        { start: [10, 50], end: [11, 30], label: '১০:৫০–১১:৩০' },
        { start: [11, 30], end: [12, 10], label: '১১:৩০–১২:১০' },
        { start: [12, 10], end: [12, 50], label: '১২:১০–১২:৫০' },
        { start: [12, 50], end: [13, 30], label: '১২:৫০–০১:৩০' } 
    ];

    const dayMap = {
        0: 0, // রবিবার -> tbody-এর 0তম সারি
        1: 1, // সোমবার -> 1ম সারি
        2: 2, // মঙ্গলবার -> 2য় সারি
        3: 3, // বুধবার -> 3য় সারি
        4: 4, // বৃহস্পতিবার -> 4র্থ সারি
    };

    // কাউন্টডাউন টাইমার ডিসপ্লে আপডেট করার ফাংশন (গ্লোবাল স্কোপে সরানো হয়েছে)
    function updateCountdownDisplay() {
        const now = new Date();
        const remainingTimeMs = nextClassStartTime.getTime() - now.getTime();

        if (remainingTimeMs <= 0) {
            clearInterval(countdownInterval);
            countdownTimerDisplay.classList.remove('visible');
            initRoutine(); // সময় শেষ হলে রুটিন পুনরায় ইনিশিয়ালাইজ করুন
            return;
        }

        const minutes = Math.floor((remainingTimeMs % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((remainingTimeMs % (1000 * 60)) / 1000);

        countdownTimeElement.textContent = 
            `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
    }


    function initRoutine() {
        const table = document.querySelector('#routine');
        const rows = table.querySelectorAll('tbody tr');
        const headers = table.querySelectorAll('thead th');
        
        // সমস্ত বিদ্যমান হাইলাইট প্রথমে সরান
        rows.forEach(row => row.classList.remove('today-row'));
        headers.forEach(header => header.classList.remove('current-time'));
        table.querySelectorAll('.current-class').forEach(cell => cell.classList.remove('current-class'));
        
        const now = new Date();
        const currentDayOfWeek = now.getDay(); 
        const currentHour = now.getHours(); 
        const currentMinute = now.getMinutes();
        const currentTimeInMinutes = getTimeInMinutes(currentHour, currentMinute);
        
        // গ্লোবাল ভেরিয়েবলগুলো রিসেট করুন
        currentClassData = null;
        nextClassData = null;
        nextClassStartTime = null;
        targetClassCellForScroll = null;

        let foundClassForToday = false;
        let dayRowIndex = dayMap[currentDayOfWeek];

        if (dayRowIndex !== undefined) { // যদি এটি একটি রুটিন দিন হয় (রবি-বৃহস্পতি)
            rows[dayRowIndex].classList.add('today-row'); 

            // 1. বর্তমানে চলমান ক্লাস খুঁজুন
            for (let i = 0; i < timeSlots.length; i++) {
                const slot = timeSlots[i];
                const slotStartMinutes = getTimeInMinutes(slot.start[0], slot.start[1]);
                const slotEndMinutes = getTimeInMinutes(slot.end[0], slot.end[1]);
                const classCell = rows[dayRowIndex].children[i + 1]; 
                const teacherLinkElement = classCell.querySelector('[data-teacher-id]');
                const teacherId = teacherLinkElement ? teacherLinkElement.dataset.teacherId : null;

                if (currentTimeInMinutes >= slotStartMinutes && currentTimeInMinutes < slotEndMinutes) {
                    // বর্তমানে চলমান ক্লাস পাওয়া গেছে
                    currentClassData = {
                        subject: classCell.querySelector('.class-name').textContent,
                        time: slot.label,
                        teacherId: teacherId,
                        cell: classCell 
                    };
                    classCell.classList.add('current-class'); 
                    headers[i + 1].classList.add('current-time'); 
                    targetClassCellForScroll = classCell;
                    foundClassForToday = true;
                    
                    // চলমান ক্লাসের পরের ক্লাসটি আসন্ন ক্লাস হিসেবে সেট করুন (যদি থাকে)
                    if (i + 1 < timeSlots.length) {
                        const nextSlot = timeSlots[i + 1];
                        const nextClassCell = rows[dayRowIndex].children[i + 2];
                        const nextTeacherLinkElement = nextClassCell.querySelector('[data-teacher-id]');
                        const nextTeacherId = nextTeacherLinkElement ? nextTeacherLinkElement.dataset.teacherId : null;
                        nextClassData = {
                            subject: nextClassCell.querySelector('.class-name').textContent,
                            time: nextSlot.label,
                            teacherId: nextTeacherId,
                            isTomorrow: false,
                            cell: nextClassCell
                        };
                        nextClassStartTime = new Date(now.getFullYear(), now.getMonth(), now.getDate(), nextSlot.start[0], nextSlot.start[1], 0);
                    } else {
                        // আজকের দিনের সব ক্লাস শেষ, পরবর্তী রুটিন দিনের প্রথম ক্লাস খুঁজুন
                        findNextRoutineDayClass(now, currentDayOfWeek, rows);
                    }
                    break; 
                } else if (currentTimeInMinutes < slotStartMinutes && !foundClassForToday) {
                    // আজকের দিনের প্রথম আসন্ন ক্লাস (যদি চলমান ক্লাস না থাকে)
                    nextClassData = {
                        subject: classCell.querySelector('.class-name').textContent,
                        time: slot.label,
                        teacherId: teacherId,
                        isTomorrow: false,
                        cell: classCell 
                    };
                    targetClassCellForScroll = classCell;
                    nextClassStartTime = new Date(now.getFullYear(), now.getMonth(), now.getDate(), slot.start[0], slot.start[1], 0);
                    foundClassForToday = true; // এটি নিশ্চিত করে যে আমরা আজকের দিনের জন্য একটি ক্লাস পেয়েছি
                    break; 
                }
            }
        } 
        
        // 2. যদি আজকের দিনে কোনো ক্লাস না পাওয়া যায় (যেমন ছুটির দিন বা সব ক্লাস শেষ), তাহলে পরবর্তী রুটিন দিন খুঁজুন
        if (!currentClassData && !nextClassData) {
            findNextRoutineDayClass(now, currentDayOfWeek, rows);
        }
        
        // ডেটা ক্যালকুলেশনের পর উইজেট আপডেট করুন
        updateDynamicWidget();
        lastRoutineUpdateTime = now.getTime(); // শেষ আপডেটের সময় সংরক্ষণ করুন
    }

    // পরবর্তী রুটিন দিনের প্রথম ক্লাস খুঁজে বের করার ফাংশন
    function findNextRoutineDayClass(now, startDayOfWeek, rows) {
        for (let i = 1; i <= 7; i++) { // আজকের দিনের পরের দিন থেকে শুরু
            const checkDayJSIndex = (startDayOfWeek + i) % 7;
            if (dayMap[checkDayJSIndex] !== undefined) { // যদি এটি একটি রুটিন দিন হয়
                const nextDayRoutineRowIndex = dayMap[checkDayJSIndex];
                const firstClassCellOfNextDay = rows[nextDayRoutineRowIndex].children[1]; 
                const firstClassSlot = timeSlots[0]; 
                const teacherLinkElement = firstClassCellOfNextDay.querySelector('[data-teacher-id]');
                const teacherId = teacherLinkElement ? firstClassCellOfNextDay.querySelector('[data-teacher-id]').dataset.teacherId : null;

                nextClassData = {
                    subject: firstClassCellOfNextDay.querySelector('.class-name').textContent,
                    time: firstClassSlot.label,
                    teacherId: teacherId,
                    isTomorrow: (i === 1), // শুধুমাত্র পরের দিন হলে 'আগামীকাল'
                    cell: firstClassCellOfNextDay 
                };
                targetClassCellForScroll = firstClassCellOfNextDay;

                let nextClassDate = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                nextClassDate.setDate(nextClassDate.getDate() + i); // আজকের তারিখের সাথে দিনের সংখ্যা যোগ করুন
                nextClassDate.setHours(firstClassSlot.start[0], firstClassSlot.start[1], 0, 0);
                nextClassStartTime = nextClassDate;
                return; // ক্লাস পাওয়া গেলে ফাংশন থেকে বেরিয়ে আসুন
            }
        }
        // যদি কোনো রুটিন দিনই না পাওয়া যায় (যেমন রুটিন খালি)
        nextClassData = null;
        nextClassStartTime = null;
        targetClassCellForScroll = null;
    }


    function updateDynamicWidget() {
        let displayData = null;
        let title = "";
        let showCountdown = false;

        if (displayMode === 'current') {
            displayData = currentClassData;
            title = "এখন চলছে:";
            showCountdown = false; 
        } else if (displayMode === 'upcoming') {
            displayData = nextClassData;
            const tomorrowText = nextClassData && nextClassData.isTomorrow ? ' (আগামীকাল)' : '';
            title = `পরবর্তী ক্লাস${tomorrowText}:`;
            showCountdown = true; 
        }

        if (displayData) {
            widgetTitle.textContent = title;
            widgetSubject.textContent = `বিষয়: ${displayData.subject}`;
            widgetTime.textContent = `সময়: ${displayData.time}`;

            const teacher = teachers[displayData.teacherId];
            if (teacher) {
                widgetTeacherBangla.textContent = `শিক্ষক: ${teacher.fullName}`;
                widgetTeacherEnglish.textContent = teacher.englishName;
                widgetProfileButtonContainer.innerHTML = '';
                if (teacher.profileLink && teacher.profileLink !== "No official profile link available." && teacher.profileLink !== "উপলব্ধ নেই") {
                    const profileButton = document.createElement('a');
                    profileButton.href = teacher.profileLink;
                    profileButton.target = "_blank";
                    profileButton.textContent = "প্রোফাইল ভিজিট করুন";
                    profileButton.classList.add('visit-profile-button');
                    widgetProfileButtonContainer.appendChild(profileButton);
                } else {
                    widgetProfileButtonContainer.innerHTML = `<span style="opacity: 0.7; font-style: italic; display: block; margin-top: 10px; color: rgba(255,255,255,0.7);">প্রোফাইল লিঙ্ক উপলব্ধ নেই।</span>`;
                }
            } else {
                widgetTeacherBangla.textContent = `শিক্ষক: উপলব্ধ নেই`;
                widgetTeacherEnglish.textContent = "";
                widgetProfileButtonContainer.innerHTML = `<span style="opacity: 0.7; font-style: italic; display: block; margin-top: 10px; color: rgba(255,255,255,0.7);">শিক্ষকের তথ্য উপলব্ধ নেই।</span>`;
            }
        } else {
            // যদি কোনো ডেটা না থাকে
            widgetTitle.textContent = (displayMode === 'current') ? "এখন কোনো ক্লাস চলছে না।" : "আজ ছুটির দিন অথবা পরবর্তী কোনো ক্লাস নেই।";
            widgetSubject.textContent = "";
            widgetTime.textContent = "";
            widgetTeacherBangla.textContent = "";
            widgetTeacherEnglish.textContent = "";
            widgetProfileButtonContainer.innerHTML = `<span class="no-class">তথ্য উপলব্ধ নেই।</span>`;
        }

        // কাউন্টডাউন টাইমার লজিক
        clearInterval(countdownInterval); 
        countdownTimerDisplay.classList.remove('visible'); 

        if (showCountdown && nextClassStartTime) {
            const now = new Date();
            const remainingTimeMs = nextClassStartTime.getTime() - now.getTime();
            const remainingTimeMinutes = Math.ceil(remainingTimeMs / (1000 * 60));

            if (remainingTimeMinutes <= 60 && remainingTimeMinutes > 0) { 
                countdownTimerDisplay.classList.add('visible');
                updateCountdownDisplay(); 
                countdownInterval = setInterval(updateCountdownDisplay, 1000); 
            }
        }
    }

    // প্রতি সেকেন্ডে শুধুমাত্র কাউন্টডাউন এবং রুটিন পরিবর্তনের জন্য চেক করবে
    function updateTimeAndRoutine() {
        const now = new Date();
        const currentMinute = now.getMinutes();
        const currentSecond = now.getSeconds();

        // রুটিন ডেটা পুনরায় গণনা করার জন্য শর্ত
        // 1. প্রতি মিনিটের শুরুতে (সেকেন্ড 0)
        // 2. যদি কোনো ক্লাস শুরু বা শেষ হওয়ার সময় হয় (কাছাকাছি)
        // 3. যদি শেষ আপডেটের পর অনেক সময় পেরিয়ে যায় (যেমন 5 মিনিট)
        const shouldReInitRoutine = (
            currentSecond === 0 && (currentMinute % 1 === 0) || // প্রতি মিনিটে
            (now.getTime() - lastRoutineUpdateTime > 5 * 60 * 1000) // অথবা 5 মিনিট পর
        );

        if (shouldReInitRoutine) {
            initRoutine(); // এটি স্বয়ংক্রিয়ভাবে updateDynamicWidget() কল করবে
        } else {
            // শুধুমাত্র কাউন্টডাউন আপডেট করুন যদি এটি দৃশ্যমান হয়
            if (countdownTimerDisplay.classList.contains('visible') && nextClassStartTime) {
                updateCountdownDisplay();
            }
        }
    }

    // প্রাথমিক স্ক্রলিং ফাংশন
    function performInitialScroll() {
        if (targetClassCellForScroll && !hasScrolledInitially && activeDayFilter === 'all') {
            setTimeout(() => {
                // Calculate position relative to the scroll wrapper
                const scrollWrapperRect = routineScrollWrapper.getBoundingClientRect();
                const targetCellRect = targetClassCellForScroll.getBoundingClientRect();

                // Calculate scroll position to center the target cell
                const scrollX = targetCellRect.left - scrollWrapperRect.left + routineScrollWrapper.scrollLeft - (scrollWrapperRect.width / 2) + (targetCellRect.width / 2);
                const scrollY = targetCellRect.top - scrollWrapperRect.top + routineScrollWrapper.scrollTop - (scrollWrapperRect.height / 2) + (targetCellRect.height / 2);

                routineScrollWrapper.scrollTo({
                    left: scrollX,
                    top: scrollY,
                    behavior: 'smooth'
                });
                hasScrolledInitially = true;
            }, 100); // ছোট বিলম্ব যাতে DOM লেআউট স্থিতিশীল হয়
        }
    }


    // শিক্ষক ডেটা
    const teachers = {
        "MS": {
            fullName: "মোহাম্মদ শোয়েব",
            englishName: "Mohammad Shoieb",
            department: "রসায়ন বিভাগ",
            contact: "যোগাযোগ: উপলব্ধ নেই",
            profileLink: "https://ramgonjcollege.gdc.gov.bd/teacher_staff_profile.php?id=21"
        },
        "RI": {
            fullName: "মো. রাকিবুল ইসলাম",
            englishName: "Md. Rakibul Islam",
            department: "গণিত বিভাগ",
            contact: "যোগাযোগ: উপলব্ধ নেই",
            profileLink: "https://ramgonjcollege.gdc.gov.bd/teacher_staff_profile.php?id=7"
        },
        "JHA": {
            fullName: "ড. মোহাম্মদ জাহাঙ্গীর আলম",
            englishName: "Dr. Mohammad Jahangir Alam",
            department: "বাংলা বিভাগ", 
            contact: "যোগাযোগ: উপলব্ধ নেই",
            profileLink: "https://ramgonjcollege.gdc.gov.bd/teacher_staff_profile.php?id=4"
        },
        "AKC": {
            fullName: "অমল কুমার চক্রবর্তী",
            englishName: "Amal Kumar Chakraborty",
            department: "ইংরেজি বিভাগ",
            contact: "যোগাযোগ: উপলব্ধ নেই",
            profileLink: "No official profile link available."
        },
        "MIH": { 
            fullName: "মো. ইবনে মাসুদ খান",
            englishName: "Md. Ibne Masud Khan",
            department: "পদার্থবিদ্যা বিভাগ", 
            contact: "যোগাযোগ: উপলব্ধ নেই",
            profileLink: "https://ramgonjcollege.gdc.gov.bd/teacher_staff_profile.php?id=3"
        },
        "MMB": {
            fullName: "মো. মাসুম বিল্লাহ",
            englishName: "Md. Masum Billah",
            department: "উদ্ভিদবিদ্যা বিভাগ",
            contact: "যোগাযোগ: উপলব্ধ নেই",
            profileLink: "https://ramgonjcollege.gdc.gov.bd/teacher_staff_profile.php?id=14"
        },
        "MSA": { 
            fullName: "মো. জসিম উদ্দিন চৌধুরী",
            englishName: "Md. Jasim Uddin Chowdhury",
            department: "গণিত বিভাগ", 
            contact: "যোগাযোগ: উপলব্ধ নেই",
            profileLink: "https://ramgonjcollege.gdc.gov.bd/teacher_staff_profile.php?id=20"
        },
        "SZH": {
            fullName: "শাহজাদ হোসেন",
            englishName: "Shazzad Hossain",
            department: "ইংরেজি বিভাগ", 
            contact: "যোগাযোগ: উপলব্ধ নেই",
            profileLink: "https://ramgonjcollege.gdc.gov.bd/teacher_staff_profile.php?id=15"
        },
        "SH": {
            fullName: "শাহাদাত হোসেন",
            englishName: "Shahadat Hossain",
            department: "তথ্য ও যোগাযোগ প্রযুক্তি বিভাগ", 
            contact: "যোগাযোগ: উপলব্ধ নেই",
            profileLink: "https://ramgonjcollege.gdc.gov.bd/teacher_staff_profile.php?id=16"
        },
        "Y": {
            fullName: "মো. ইউসুফ",
            englishName: "Md. Yousuf",
            department: "প্রাণিবিদ্যা বিভাগ",
            contact: "যোগাযোগ: উপলব্ধ নেই",
            profileLink: "https://ramgonjcollege.gdc.gov.bd/teacher_staff_profile.php?id=37"
        },
        "MLA": { 
            fullName: "মো. লিপু আহমেদ",
            englishName: "Md. Lipu Ahammed",
            department: "বাংলা বিভাগ",
            contact: "যোগাযোগ: উপলব্ধ নেই",
            profileLink: "https://ramgonjcollege.gdc.gov.bd/teacher_staff_profile.php?id=34"
        },
        "AA": {
            fullName: "মো. আল আমিন",
            englishName: "Md. Al Amin",
            department: "প্রাণিবিদ্যা বিভাগ", 
            contact: "যোগাযোগ: উপলব্ধ নেই",
            profileLink: "https://ramgonjcollege.gdc.gov.bd/teacher_staff_profile.php?id=13"
        },
        "FE": {
            fullName: "ফজলে এলাহী",
            englishName: "Fazla Elahi",
            department: "উদ্ভিদবিদ্যা বিভাগ",
            contact: "যোগাযোগ: উপলব্ধ নেই",
            profileLink: "https://ramgonjcollege.gdc.gov.bd/teacher_staff_profile.php?id=19"
        },
        "MTH": { 
            fullName: "মো. তারেক আজিজ",
            englishName: "Md. Tarek Aziz",
            department: "পদার্থবিদ্যা বিভাগ", 
            contact: "যোগাযোগ: উপলব্ধ নেই",
            profileLink: "https://ramgonjcollege.gdc.gov.bd/teacher_staff_profile.php?id=21138113006"
        },
        "SA": { 
            fullName: "শামীম আলম",
            englishName: "Shamim Alam",
            department: "ইংরেজি বিভাগ", 
            contact: "যোগাযোগ: উপলব্ধ নেই",
            profileLink: "https://ramgonjcollege.gdc.gov.bd/teacher_staff_profile.php?id=18"
        },
        "JA": {
            fullName: "জারিফ আলিম",
            englishName: "Jarif Alim",
            department: "বাংলা বিভাগ", 
            contact: "যোগাযোগ: উপলব্ধ নেই",
            profileLink: "https://ramgonjcollege.gdc.gov.bd/teacher_staff_profile.php?id=23"
        },
        "HR": {
            fullName: "হাফিজুর রহমান",
            englishName: "Hafizur Rahman",
            department: "পদার্থবিদ্যা বিভাগ", 
            contact: "যোগাযোগ: উপলব্ধ নেই",
            profileLink: "https://ramgonjcollege.gdc.gov.bd/teacher_staff_profile.php?id=5"
        },
        "EHU": { 
            fullName: "ইমরান হাকিম উল্লাহ",
            englishName: "Emran Hakim Ullah",
            department: "ইসলামের ইতি. ও সংস্কৃতি বিভাগ",
            contact: "যোগাযোগ: উপলব্ধ নেই",
            profileLink: "https://ramgonjcollege.gdc.gov.bd/teacher_staff_profile.php?id=36"
        },
        // অন্যান্য শিক্ষক যারা সরাসরি HTML data-teacher-id তে নেই কিন্তু তালিকায় আছেন
        "03399": { fullName: "প্রফেসর মো. ইউসুফ", englishName: "Professor Md. Yousuf", department: "অর্থনীতি বিভাগ", contact: "যোগাযোগ: উপলব্ধ নেই", profileLink: "No official profile link available." },
        "7710": { fullName: "প্রফেসর এ.বি.এম. শহীদ উল্লাহ", englishName: "Professor A.B.M Shahid Ullah", department: "রাষ্ট্রবিজ্ঞান বিভাগ", contact: "যোগাযোগ: উপলব্ধ নেই", profileLink: "No official profile link available." },
        "00014938": { fullName: "মোহাম্মদ মোজাম্মেল হক", englishName: "Mohammad Mozammel Hoque", department: "দর্শন বিভাগ", contact: "যোগাযোগ: উপলব্ধ নেই", profileLink: "No official profile link available." },
        "015039": { fullName: "মোহাম্মদ আব্দুল হালিম মিয়া", englishName: "Mohammad Abdul Halim Miah", department: "অর্থনীতি বিভাগ", contact: "যোগাযোগ: উপলব্ধ নেই", profileLink: "No official profile link available." },
        "016043": { fullName: "রাজেশ ত্রিপুরা", englishName: "Rajesh Tripura", department: "রাষ্ট্রবিজ্ঞান বিভাগ", contact: "যোগাযোগ: উপলব্ধ নেই", profileLink: "No official profile link available." },
        "022879": { fullName: "মো. ওমর ফারুক", englishName: "Md. Omar Faruque", department: "দর্শন বিভাগ", contact: "যোগাযোগ: উপলব্ধ নেই", profileLink: "No official profile link available." },
        "2414125010": { fullName: "মো. জুবায়ের মিয়া", englishName: "Md. Jobair Mia", department: "দর্শন বিভাগ", contact: "যোগাযোগ: উপলব্ধ নেই", profileLink: "No official profile link available." },
        "18136116002": { fullName: "জান্নাতুল ফেরদৌস", englishName: "Jannatul Ferdous", department: "কৃষিশিক্ষা বিভাগ", contact: "যোগাযোগ: উপলব্ধ নেই", profileLink: "No official profile link available." },
        "21138128043": { fullName: "মো. ইকবাল হোসেন পাটোয়ারী", englishName: "Md. Iqbal Hossain Patwary", department: "পদার্থবিদ্যা বিভাগ", contact: "যোগাযোগ: উপলব্ধ নেই", profileLink: "No official profile link available." },
        "22140108076": { fullName: "জাকারিয়া সোলায়মান", englishName: "Jakaria Solayman", department: "ইসলামের ইতি. ও সংস্কৃতি বিভাগ", contact: "যোগাযোগ: উপলব্ধ নেই", profileLink: "No official profile link available." },
        "24141156033": { fullName: "মো. ইউসুফ কামাল", englishName: "Md. Yusuf Kamal", department: "হিসাববিজ্ঞান বিভাগ", contact: "যোগাযোগ: উপলব্ধ নেই", profileLink: "No official profile link available." }
    };


    // শিক্ষক প্রোফাইল পপ-আপ হ্যান্ডলিং
    const teacherModal = document.getElementById('teacherModal');
    const closeButton = teacherModal.querySelector('.close-button');
    const teacherNameBangla = document.getElementById('teacherNameBangla');
    const teacherNameEnglish = document.getElementById('teacherNameEnglish');
    const teacherDepartment = document.getElementById('teacherDepartment');
    const teacherContact = document.getElementById('teacherContact');
    const teacherProfileButtonContainer = document.getElementById('teacherProfileButtonContainer');

    function openTeacherModal(teacherId) {
        const teacher = teachers[teacherId];
        if (teacher) {
            teacherNameBangla.textContent = teacher.fullName;
            teacherNameEnglish.textContent = teacher.englishName || "English Name Not Available"; 
            teacherDepartment.textContent = `বিভাগ: ${teacher.department || "উপলব্ধ নেই"}`; 
            teacherContact.textContent = `যোগাযোগ: ${teacher.contact || "উপলব্ধ নেই"}`; 
            
            teacherProfileButtonContainer.innerHTML = ''; 

            if (teacher.profileLink && teacher.profileLink !== "No official profile link available." && teacher.profileLink !== "উপলব্ধ নেই") {
                const profileButton = document.createElement('a');
                profileButton.href = teacher.profileLink;
                profileButton.target = "_blank"; 
                profileButton.textContent = "প্রোফাইল ভিজিট করুন";
                profileButton.classList.add('visit-profile-button'); 
                teacherProfileButtonContainer.appendChild(profileButton);
            } else {
                widgetProfileButtonContainer.innerHTML = `<span style="opacity: 0.7; font-style: italic; display: block; margin-top: 10px; color: rgba(255,255,255,0.7);">প্রোফাইল লিঙ্ক উপলব্ধ নেই।</span>`;
            }
            teacherModal.classList.add('active');
        } else {
            teacherNameBangla.textContent = "শিক্ষকের তথ্য উপলব্ধ নেই";
            teacherNameEnglish.textContent = "";
            teacherDepartment.textContent = "";
            teacherContact.textContent = "";
            teacherProfileButtonContainer.innerHTML = "";
            teacherModal.classList.add('active');
        }
    }

    function closeTeacherModal() {
        teacherModal.classList.remove('active');
    }

    document.addEventListener('click', (e) => {
        const teacherLink = e.target.closest('[data-teacher-id]');
        if (teacherLink) {
            e.preventDefault(); 
            const teacherId = teacherLink.dataset.teacherId;
            openTeacherModal(teacherId);
        }
    });

    closeButton.addEventListener('click', closeTeacherModal);
    teacherModal.addEventListener('click', (e) => {
        if (e.target === teacherModal) { 
            closeTeacherModal();
        }
    });

    // সার্চ কার্যকারিতা
    const searchInput = document.getElementById('searchInput');
    const routineBody = document.querySelector('#routine tbody');
    const routineRows = routineBody.querySelectorAll('tr');

    function applySearchFilter() {
        const searchTerm = searchInput.value.toLowerCase().trim();

        routineRows.forEach(row => {
            let rowMatches = false;
            const dayCell = row.querySelector('td:first-child');
            const dayName = dayCell ? dayCell.textContent.toLowerCase() : '';

            const isRowVisibleByDayFilter = row.style.display !== 'none';

            if (!isRowVisibleByDayFilter && activeDayFilter !== 'all') {
                return; 
            }

            if (dayName.includes(searchTerm)) {
                rowMatches = true;
            }

            const classCells = row.querySelectorAll('td:not(:first-child)');
            for (const cell of classCells) {
                const classNameElement = cell.querySelector('.class-name');
                const classInfoElement = cell.querySelector('.class-info');
                
                if (classNameElement && classNameElement.textContent.toLowerCase().includes(searchTerm)) {
                    rowMatches = true;
                }

                if (classInfoElement) {
                    const roomMatch = classInfoElement.textContent.match(/(\d+)/); 
                    if (roomMatch && roomMatch[1] && roomMatch[1].toLowerCase().includes(searchTerm)) {
                        rowMatches = true;
                    }

                    const teacherLink = classInfoElement.querySelector('[data-teacher-id]');
                    const teacherId = teacherLink ? teacherLink.dataset.teacherId : null;
                    const teacher = teachers[teacherId];

                    if (teacher) {
                        if (teacher.fullName.toLowerCase().includes(searchTerm) ||
                            teacher.englishName.toLowerCase().includes(searchTerm)) {
                            rowMatches = true;
                        }
                    }
                }
            }

            if (searchTerm === '' || rowMatches) {
                row.style.display = ''; 
            } else {
                row.style.display = 'none'; 
            }
        });
    }

    searchInput.addEventListener('input', applySearchFilter);

    // দিন ফিল্টার কার্যকারিতা
    const dayFilterButtonsContainer = document.getElementById('dayFilterButtons');
    const dayFilterButtons = dayFilterButtonsContainer.querySelectorAll('.day-filter-button');
    let activeDayFilter = 'all'; 

    function filterRoutineByDay(selectedDayIndex) {
        activeDayFilter = selectedDayIndex; 
        searchInput.value = ''; 

        routineRows.forEach((row, index) => {
            const dayCell = row.querySelector('td:first-child');
            const rowDayName = dayCell.textContent.toLowerCase();
            const dayMapReverse = {
                'রবিবার': 0,
                'সোমবার': 1,
                'মঙ্গলবার': 2,
                'বুধবার': 3,
                'বৃহস্পতিবার': 4
            };
            const rowDayIndex = dayMapReverse[rowDayName];

            if (selectedDayIndex === 'all' || rowDayIndex === parseInt(selectedDayIndex)) {
                row.style.display = ''; 
            } else {
                row.style.display = 'none'; 
            }
        });

        dayFilterButtons.forEach(button => {
            if (button.dataset.dayIndex === String(selectedDayIndex)) {
                button.classList.add('active');
            } else {
                button.classList.remove('active');
            }
        });

        applySearchFilter();
    }

    dayFilterButtons.forEach(button => {
        button.addEventListener('click', () => {
            filterRoutineByDay(button.dataset.dayIndex);
        });
    });

    // LLM প্রশ্ন পপ-আপ হ্যান্ডলিং (Class Query Modal)
    const classQueryModal = document.getElementById('classQueryModal');
    const classQueryCloseButton = document.getElementById('classQueryCloseButton');
    const classQuerySubjectTitle = document.getElementById('classQuerySubjectTitle');
    const classQuestionInput = document.getElementById('classQuestionInput');
    const askClassGeminiButton = document.getElementById('askClassGeminiButton');
    const classQueryLoadingSpinner = document.getElementById('classQueryLoadingSpinner');
    const classQueryResponseArea = document.getElementById('classQueryResponseArea');
    const copyClassQueryResponseButton = document.getElementById('copyClassQueryResponse');
    const llmResponseModeToggle = document.getElementById('llmResponseModeToggle');

    let currentSubjectForClassQuery = '';

    function openClassQueryModal(subject) {
        currentSubjectForClassQuery = subject;
        classQuerySubjectTitle.textContent = `${subject} ক্লাস সম্পর্কে প্রশ্ন করুন`;
        classQuestionInput.value = ''; 
        classQueryResponseArea.textContent = ''; 
        classQueryLoadingSpinner.style.display = 'none'; 
        classQueryModal.classList.add('active');
        copyClassQueryResponseButton.style.display = 'none'; // Hide copy button initially

        // Load saved LLM response mode
        const savedLlmMode = localStorage.getItem('llmResponseMode');
        if (savedLlmMode === 'detailed') {
            llmResponseModeToggle.checked = true;
        } else {
            llmResponseModeToggle.checked = false; // Default to direct
        }
    }

    function closeClassQueryModal() {
        classQueryModal.classList.remove('active');
    }

    classQueryCloseButton.addEventListener('click', closeClassQueryModal);
    classQueryModal.addEventListener('click', (e) => {
        if (e.target === classQueryModal) {
            closeClassQueryModal();
        }
    });

    // LLM API কল ফাংশন (Class Query)
    async function askGeminiAboutClass(subject, question) {
        classQueryLoadingSpinner.style.display = 'block'; 
        classQueryResponseArea.textContent = ''; 
        askClassGeminiButton.disabled = true; 
        copyClassQueryResponseButton.style.display = 'none';

        const isDetailedMode = llmResponseModeToggle.checked;

        const overviewKeywords = ["মূল বিষয়", "সারাংশ", "পরিচয়", "ব্যাপারে", "কী কী পড়ানো হয়", "পাঠ্যক্রম", "ওভারভিউ", "overview", "main topics", "syllabus", "সম্পর্কে"];
        const questionAsksForOverview = overviewKeywords.some(keyword => question.toLowerCase().includes(keyword));

        let prompt;
        if (isDetailedMode) {
            if (questionAsksForOverview) {
                prompt = `Provide a detailed and comprehensive overview of the key concepts typically covered in a college-level ${subject} class based on the user's explicit request: "${question}". Also, suggest one or two common challenges students face in this subject and a tip to overcome them. Answer in Bengali.`;
            } else {
                // Detailed answer to the specific question, without general subject overview
                prompt = `Provide a detailed and comprehensive answer to the following question about a college-level ${subject} class. Focus directly on answering the question with relevant context and explanation, but do not provide a general overview of the entire subject unless the question explicitly asks for it: "${question}". Answer in Bengali.`;
            }
        } else {
            // Direct and concise answer
            prompt = `Provide only the direct and concise answer to the following question about a college-level ${subject} class, without any introductory or concluding remarks: "${question}". Answer in Bengali.`;
        }

        let chatHistory = [];
        chatHistory.push({ role: "user", parts: [{ text: prompt }] });

        const payload = { contents: chatHistory };
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${API_KEY}`;
        console.log("Calling Gemini API with URL:", apiUrl); // Debugging API URL

        try {
            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });
            const result = await response.json();
            console.log("Gemini API response:", result); // Debugging API response

            if (result.candidates && result.candidates.length > 0 &&
                result.candidates[0].content && result.candidates[0].content.parts &&
                result.candidates[0].content.parts.length > 0) {
                const text = result.candidates[0].content.parts[0].text;
                classQueryResponseArea.textContent = text;
                copyClassQueryResponseButton.style.display = 'inline-block'; // Show copy button
            } else {
                classQueryResponseArea.textContent = "দুঃখিত, আপনার প্রশ্নের উত্তর খুঁজে পাওয়া যায়নি। (API প্রতিক্রিয়া অপ্রত্যাশিত ছিল)";
                console.error("Gemini API response structure unexpected:", result);
            }
        } catch (error) {
            classQueryResponseArea.textContent = "একটি ত্রুটি হয়েছে। অনুগ্রহ করে আবার চেষ্টা করুন। (নেটওয়ার্ক বা API সমস্যা)";
            console.error("Error calling Gemini API:", error);
        } finally {
            classQueryLoadingSpinner.style.display = 'none'; 
            askClassGeminiButton.disabled = false; 
        }
    }

    askClassGeminiButton.addEventListener('click', () => {
        const question = classQuestionInput.value.trim();
        if (currentSubjectForClassQuery && question) {
            askGeminiAboutClass(currentSubjectForClassQuery, question);
        } else if (!question) {
            showMessage("অনুগ্রহ করে আপনার প্রশ্ন লিখুন।");
        }
    });

    document.addEventListener('click', (e) => {
        const askGeminiButtonInCell = e.target.closest('.ask-gemini-button');
        if (askGeminiButtonInCell) {
            e.preventDefault();
            const subject = askGeminiButtonInCell.dataset.subject;
            openClassQueryModal(subject);
        }
    });

    // LLM Response Mode Toggle event listener
    llmResponseModeToggle.addEventListener('change', () => {
        if (llmResponseModeToggle.checked) {
            localStorage.setItem('llmResponseMode', 'detailed');
        } else {
            localStorage.setItem('llmResponseMode', 'direct');
        }
    });


    // LLM সারাংশ ও প্রস্তুতি পপ-আপ হ্যান্ডলিং (Class Summary Modal)
    const classSummaryModal = document.getElementById('classSummaryModal');
    const classSummaryCloseButton = document.getElementById('classSummaryCloseButton');
    const classSummarySubjectTitle = document.getElementById('classSummarySubjectTitle');
    const classSummaryInput = document.getElementById('classSummaryInput');
    const askClassSummaryButton = document.getElementById('askClassSummaryButton');
    const classSummaryLoadingSpinner = document.getElementById('classSummaryLoadingSpinner');
    const classSummaryResponseArea = document.getElementById('classSummaryResponseArea');
    const copyClassSummaryResponseButton = document.getElementById('copyClassSummaryResponse');

    let currentSubjectForClassSummary = '';

    function openClassSummaryModal(subject) {
        currentSubjectForClassSummary = subject;
        classSummarySubjectTitle.textContent = `ক্লাস সারাংশ ও প্রস্তুতি: ${subject}`;
        classSummaryInput.value = ''; 
        classSummaryResponseArea.textContent = ''; 
        classSummaryLoadingSpinner.style.display = 'none'; 
        classSummaryModal.classList.add('active');
        copyClassSummaryResponseButton.style.display = 'none'; // Hide copy button initially
    }

    function closeClassSummaryModal() {
        classSummaryModal.classList.remove('active');
    }

    classSummaryCloseButton.addEventListener('click', closeClassSummaryModal);
    classSummaryModal.addEventListener('click', (e) => {
        if (e.target === classSummaryModal) {
            closeClassSummaryModal();
        }
    });

    // LLM API কল ফাংশন (Class Summary)
    async function askGeminiForClassSummary(subject, topic) {
        classSummaryLoadingSpinner.style.display = 'block'; 
        classSummaryResponseArea.textContent = ''; 
        askClassSummaryButton.disabled = true; 
        copyClassSummaryResponseButton.style.display = 'none';

        const prompt = `For a college-level ${subject} class, provide a concise summary of the topic: '${topic}'. Include 3-5 key points and suggest one practical study tip related to this topic. Answer in Bengali.`;

        let chatHistory = [];
        chatHistory.push({ role: "user", parts: [{ text: prompt }] });

        const payload = { contents: chatHistory };
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${API_KEY}`;
        console.log("Calling Gemini API with URL:", apiUrl); // Debugging API URL

        try {
            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });
            const result = await response.json();
            console.log("Gemini API response:", result); // Debugging API response

            if (result.candidates && result.candidates.length > 0 &&
                result.candidates[0].content && result.candidates[0].content.parts &&
                result.candidates[0].content.parts.length > 0) {
                const text = result.candidates[0].content.parts[0].text;
                classSummaryResponseArea.textContent = text;
                copyClassSummaryResponseButton.style.display = 'inline-block'; // Show copy button
            } else {
                classSummaryResponseArea.textContent = "দুঃখিত, আপনার অনুরোধের সারাংশ তৈরি করা যায়নি। (API প্রতিক্রিয়া অপ্রত্যাশিত ছিল)";
                console.error("Gemini API response structure unexpected:", result);
            }
        } catch (error) {
            classSummaryResponseArea.textContent = "একটি ত্রুটি হয়েছে। অনুগ্রহ করে আবার চেষ্টা করুন। (নেটওয়ার্ক বা API সমস্যা)";
            console.error("Error calling Gemini API:", error);
        } finally {
            classSummaryLoadingSpinner.style.display = 'none'; 
            askClassSummaryButton.disabled = false; 
        }
    }

    askClassSummaryButton.addEventListener('click', () => {
        const topic = classSummaryInput.value.trim();
        if (currentSubjectForClassSummary && topic) {
            askGeminiForClassSummary(currentSubjectForClassSummary, topic);
        } else if (!topic) {
            showMessage("অনুগ্রহ করে একটি বিষয় বা প্রস্তুতির ধরন লিখুন।");
        }
    });

    document.addEventListener('click', (e) => {
        const classSummaryButtonInCell = e.target.closest('.class-summary-button');
        if (classSummaryButtonInCell) {
            e.preventDefault();
            const subject = classSummaryButtonInCell.dataset.subject;
            openClassSummaryModal(subject);
        }
    });

    // টগল বাটন ইভেন্ট লিসেনার
    currentClassBtn.addEventListener('click', () => {
        displayMode = 'current';
        currentClassBtn.classList.add('active');
        upcomingClassBtn.classList.remove('active');
        updateDynamicWidget();
    });

    upcomingClassBtn.addEventListener('click', () => {
        displayMode = 'upcoming';
        upcomingClassBtn.classList.add('active');
        currentClassBtn.classList.remove('active');
        updateDynamicWidget();
    });

    // Zoom functionality variables
    let currentZoom = 1.0;
    const minZoom = 0.8;
    const maxZoom = 2.0;
    const tableElement = document.getElementById('routine');
    const zoomLevelDisplay = document.getElementById('zoomLevelDisplay');
    const routineScrollWrapper = document.querySelector('.routine-scroll-wrapper'); // New wrapper

    function applyZoom() {
        tableElement.style.transform = `scale(${currentZoom})`;
        zoomLevelDisplay.textContent = `${Math.round(currentZoom * 100)}%`;
    }

    // Mouse wheel zoom
    routineScrollWrapper.addEventListener('wheel', (e) => {
        e.preventDefault(); // Prevent default page scroll

        const oldZoom = currentZoom;
        if (e.deltaY < 0) { // Scroll up = zoom in
            currentZoom = Math.min(maxZoom, currentZoom + 0.05); // Smaller step for wheel
        } else { // Scroll down = zoom out
            currentZoom = Math.max(minZoom, currentZoom - 0.05); // Smaller step for wheel
        }

        applyZoom();
    }, { passive: false }); // Use passive: false to allow preventDefault

    // Touch pinch-to-zoom (for mobile)
    let initialPinchDistance = 0;
    let lastZoom = 1.0;

    routineScrollWrapper.addEventListener('touchstart', (e) => {
        if (e.touches.length === 2) {
            initialPinchDistance = Math.hypot(
                e.touches[0].pageX - e.touches[1].pageX,
                e.touches[0].pageY - e.touches[1].pageY
            );
            lastZoom = currentZoom;
        }
    }, { passive: false });

    routineScrollWrapper.addEventListener('touchmove', (e) => {
        if (e.touches.length === 2) {
            e.preventDefault(); // Prevent scrolling while pinching
            const currentPinchDistance = Math.hypot(
                e.touches[0].pageX - e.touches[1].pageX,
                e.touches[0].pageY - e.touches[1].pageY
            );
            const scaleFactor = currentPinchDistance / initialPinchDistance;
            currentZoom = Math.max(minZoom, Math.min(maxZoom, lastZoom * scaleFactor));
            applyZoom();
        }
    }, { passive: false });

    // থিম সুইচার কার্যকারিতা
    const themeToggle = document.getElementById('themeToggle');
    const body = document.body;

    function applyTheme(theme) {
        if (theme === 'light') {
            body.classList.add('light-mode');
            themeToggle.checked = true;
        } else {
            body.classList.remove('light-mode');
            themeToggle.checked = false;
        }
    }

    // Load saved theme from localStorage
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme) {
        applyTheme(savedTheme);
    } else {
        // Default to dark mode if no theme is saved
        applyTheme('dark');
    }

    themeToggle.addEventListener('change', () => {
        if (themeToggle.checked) {
            applyTheme('light');
            localStorage.setItem('theme', 'light');
        } else {
            applyTheme('dark');
            localStorage.setItem('theme', 'dark');
        }
    });

    // কাস্টম মেসেজ বক্স কার্যকারিতা
    const messageBoxOverlay = document.getElementById('messageBoxOverlay');
    const messageBox = document.getElementById('messageBox');
    const messageBoxText = document.getElementById('messageBoxText');
    const messageBoxCloseButton = document.getElementById('messageBoxCloseButton');

    function showMessage(message) {
        messageBoxText.textContent = message;
        messageBoxOverlay.classList.add('active');
    }

    messageBoxCloseButton.addEventListener('click', () => {
        messageBoxOverlay.classList.remove('active');
    });

    messageBoxOverlay.addEventListener('click', (e) => {
        if (e.target === messageBoxOverlay) {
            messageBoxOverlay.classList.remove('active');
        }
    });

    // কপি বাটন কার্যকারিতা
    function copyToClipboard(textToCopy) {
        const textArea = document.createElement('textarea');
        textArea.value = textToCopy;
        document.body.appendChild(textArea);
        textArea.select();
        try {
            document.execCommand('copy');
            showMessage("কপি করা হয়েছে!");
        } catch (err) {
            console.error('Failed to copy: ', err);
            showMessage("কপি করতে ব্যর্থ হয়েছে।");
        }
        document.body.removeChild(textArea);
    }

    copyClassQueryResponseButton.addEventListener('click', () => {
        copyToClipboard(classQueryResponseArea.textContent);
    });

    copyClassSummaryResponseButton.addEventListener('click', () => {
        copyToClipboard(classSummaryResponseArea.textContent);
    });


    // পৃষ্ঠা লোড হলে সব কিছু ইনিশিয়ালাইজ করুন
    document.addEventListener('DOMContentLoaded', function() {
      initRoutine(); // প্রাথমিক রুটিন ডেটা লোড করুন
      filterRoutineByDay('all'); // নিশ্চিত করুন যে সব দিন দৃশ্যমান আছে স্ক্রলিংয়ের জন্য
      updateDynamicWidget(); // প্রাথমিক উইজেট ডেটা লোড করুন
      performInitialScroll(); // প্রাথমিক স্বয়ংক্রিয় স্ক্রলিং করুন
      applyZoom(); // Apply initial zoom level (1.0) and update display

      // প্রতি সেকেন্ডে কাউন্টডাউন এবং রুটিন পরিবর্তনের জন্য চেক করবে
      setInterval(updateTimeAndRoutine, 1000); 
    });
  </script>
</body>
</html>
